<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>【翻译】基于虚拟DOM库(Snabbdom)的迷你React | 自然醒的博客</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.ico">
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?681a9f14f2db8e622747ef03c33bb367";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
    <meta name="description" content=" ">
    
    <link rel="preload" href="/assets/css/0.styles.a1257572.css" as="style"><link rel="preload" href="/assets/js/app.318ac574.js" as="script"><link rel="preload" href="/assets/js/3.38c624e7.js" as="script"><link rel="preload" href="/assets/js/1.a547ec77.js" as="script"><link rel="preload" href="/assets/js/33.4355b0d1.js" as="script"><link rel="prefetch" href="/assets/js/10.6013c20b.js"><link rel="prefetch" href="/assets/js/11.3d8fc37f.js"><link rel="prefetch" href="/assets/js/12.d356848f.js"><link rel="prefetch" href="/assets/js/13.503aa3ef.js"><link rel="prefetch" href="/assets/js/14.0cc170d7.js"><link rel="prefetch" href="/assets/js/15.80a29d65.js"><link rel="prefetch" href="/assets/js/16.eeef94d5.js"><link rel="prefetch" href="/assets/js/17.473fd739.js"><link rel="prefetch" href="/assets/js/18.7a94ffa7.js"><link rel="prefetch" href="/assets/js/19.1049cfdf.js"><link rel="prefetch" href="/assets/js/20.928b8fee.js"><link rel="prefetch" href="/assets/js/21.8fa143ce.js"><link rel="prefetch" href="/assets/js/22.b094a8de.js"><link rel="prefetch" href="/assets/js/23.9897185b.js"><link rel="prefetch" href="/assets/js/24.12f7413e.js"><link rel="prefetch" href="/assets/js/25.251a0dbc.js"><link rel="prefetch" href="/assets/js/26.bf0e0cf4.js"><link rel="prefetch" href="/assets/js/27.d4dc9aa5.js"><link rel="prefetch" href="/assets/js/28.b67394ce.js"><link rel="prefetch" href="/assets/js/29.2c093fe1.js"><link rel="prefetch" href="/assets/js/30.88baa945.js"><link rel="prefetch" href="/assets/js/31.db871da7.js"><link rel="prefetch" href="/assets/js/32.aca26529.js"><link rel="prefetch" href="/assets/js/34.1e25eec3.js"><link rel="prefetch" href="/assets/js/35.33b6be8f.js"><link rel="prefetch" href="/assets/js/36.af8dc1b5.js"><link rel="prefetch" href="/assets/js/37.0a442b7d.js"><link rel="prefetch" href="/assets/js/38.b8932c36.js"><link rel="prefetch" href="/assets/js/39.873ac12b.js"><link rel="prefetch" href="/assets/js/4.22f3476d.js"><link rel="prefetch" href="/assets/js/40.902ba1b5.js"><link rel="prefetch" href="/assets/js/41.b3a01dd9.js"><link rel="prefetch" href="/assets/js/42.e124f445.js"><link rel="prefetch" href="/assets/js/43.a3cd5e06.js"><link rel="prefetch" href="/assets/js/44.77a9226e.js"><link rel="prefetch" href="/assets/js/45.0c563d44.js"><link rel="prefetch" href="/assets/js/46.abecd608.js"><link rel="prefetch" href="/assets/js/47.945d2559.js"><link rel="prefetch" href="/assets/js/48.96121d35.js"><link rel="prefetch" href="/assets/js/49.b6e988b3.js"><link rel="prefetch" href="/assets/js/5.eb73409d.js"><link rel="prefetch" href="/assets/js/50.51197aa2.js"><link rel="prefetch" href="/assets/js/51.cba93298.js"><link rel="prefetch" href="/assets/js/52.5845bf72.js"><link rel="prefetch" href="/assets/js/53.05e334fd.js"><link rel="prefetch" href="/assets/js/54.730245bb.js"><link rel="prefetch" href="/assets/js/55.fe4f1899.js"><link rel="prefetch" href="/assets/js/56.9fc2cca2.js"><link rel="prefetch" href="/assets/js/57.ba509f83.js"><link rel="prefetch" href="/assets/js/58.e2c3009c.js"><link rel="prefetch" href="/assets/js/59.45cf1f42.js"><link rel="prefetch" href="/assets/js/6.c75b1c30.js"><link rel="prefetch" href="/assets/js/60.cb622813.js"><link rel="prefetch" href="/assets/js/61.77d4b62e.js"><link rel="prefetch" href="/assets/js/62.7acffff4.js"><link rel="prefetch" href="/assets/js/63.a9a1e121.js"><link rel="prefetch" href="/assets/js/64.2952287b.js"><link rel="prefetch" href="/assets/js/65.e46eb76e.js"><link rel="prefetch" href="/assets/js/66.d6579358.js"><link rel="prefetch" href="/assets/js/67.263c1a64.js"><link rel="prefetch" href="/assets/js/68.167b338f.js"><link rel="prefetch" href="/assets/js/69.7cc7de17.js"><link rel="prefetch" href="/assets/js/7.7e6be3ad.js"><link rel="prefetch" href="/assets/js/70.4cd87fd5.js"><link rel="prefetch" href="/assets/js/71.03d8452b.js"><link rel="prefetch" href="/assets/js/72.ed53a810.js"><link rel="prefetch" href="/assets/js/73.9a316584.js"><link rel="prefetch" href="/assets/js/74.fabacaa2.js"><link rel="prefetch" href="/assets/js/75.8d7e3516.js"><link rel="prefetch" href="/assets/js/76.ffbb5827.js"><link rel="prefetch" href="/assets/js/77.a54abacd.js"><link rel="prefetch" href="/assets/js/78.387b274e.js"><link rel="prefetch" href="/assets/js/79.4245741e.js"><link rel="prefetch" href="/assets/js/8.089b1e80.js"><link rel="prefetch" href="/assets/js/80.e7c18fed.js"><link rel="prefetch" href="/assets/js/81.c6465575.js"><link rel="prefetch" href="/assets/js/82.4e0588dd.js"><link rel="prefetch" href="/assets/js/83.846e3dd3.js"><link rel="prefetch" href="/assets/js/84.42030c5b.js"><link rel="prefetch" href="/assets/js/85.eb6c0afb.js"><link rel="prefetch" href="/assets/js/86.b1e4b9b2.js"><link rel="prefetch" href="/assets/js/87.f48ae41b.js"><link rel="prefetch" href="/assets/js/88.84bcc4c7.js"><link rel="prefetch" href="/assets/js/89.c36e2e4e.js"><link rel="prefetch" href="/assets/js/9.a15a624d.js"><link rel="prefetch" href="/assets/js/90.1b535ac6.js"><link rel="prefetch" href="/assets/js/91.643af168.js"><link rel="prefetch" href="/assets/js/92.56bcb90f.js"><link rel="prefetch" href="/assets/js/93.2c179837.js"><link rel="prefetch" href="/assets/js/94.5e1d5354.js"><link rel="prefetch" href="/assets/js/95.1591a73b.js"><link rel="prefetch" href="/assets/js/96.07185bc3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a1257572.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-5bb33761><div data-v-5bb33761><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-5bb33761 data-v-5bb33761><h3 class="title" data-v-59e6cb88>自然醒的博客</h3> <p class="description" data-v-59e6cb88> </p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2022
      </a></span></div></div> <div class="hide" data-v-5bb33761><header class="navbar" data-v-5bb33761><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">自然醒的博客</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><a href="/about/" class="nav-link"><i class="iconfont reco-account"></i>
  自我介绍
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-5bb33761></div> <aside class="sidebar" data-v-5bb33761><div class="personal-info-wrapper" data-v-1fad0c41 data-v-5bb33761><!----> <!----> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>85</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>127</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><a href="/about/" class="nav-link"><i class="iconfont reco-account"></i>
  自我介绍
</a></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-5bb33761><h3 class="title" data-v-59e6cb88>【翻译】基于虚拟DOM库(Snabbdom)的迷你React</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2022
      </a></span></div></div> <div data-v-5bb33761><div data-v-5bb33761><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">【翻译】基于虚拟DOM库(Snabbdom)的迷你React</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>shenfq</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>5/1/2019</span></i> <!----> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>前端框架</span><span class="tag-item" data-v-8a445198>react</span><span class="tag-item" data-v-8a445198>virtual dom</span><span class="tag-item" data-v-8a445198>虚拟 DOM</span><span class="tag-item" data-v-8a445198>Snabbdom</span><span class="tag-item" data-v-8a445198>翻译</span></i></div></div> <div class="content__default"><blockquote><p><a href="https://medium.com/@yelouafi/react-less-virtual-dom-with-snabbdom-functions-everywhere-53b672cb2fe3" target="_blank" rel="noopener noreferrer">原文链接<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <blockquote><p>原文写于 2015-07-31，虽然时间比较久远，但是对于我们理解虚拟 DOM 和 view 层之间的关系还是有很积极的作用的。</p></blockquote> <p>React 是 JavaScript 社区的新成员，尽管 JSX （在 JavaScript 中使用 HTML 语法）存在一定的争议，但是对于虚拟 DOM 人们有不一样的看法。</p> <p>对于不熟悉的人来说，虚拟 DOM 可以描述为某个时刻真实DOM的简单表示。其思想是：每次 UI 状态发生更改时，重新创建一个虚拟 DOM，而不是直接使用命令式的语句更新真实 DOM ，底层库将对应的更新映射到真实 DOM 上。</p> <p>需要注意的是，更新操作并没有替换整个 DOM 树（例如使用 innerHTML 重新设置 HTML 字符串），而是替换 DOM 节点中实际修改的部分（改变节点属性、添加子节点）。这里使用的是增量更新，通过比对新旧虚拟 DOM 来推断更新的部分，然后将更新的部分通过补丁的方式更新到真实 DOM 中。</p> <p>虚拟 DOM 因为高效的性能经常受到特别的关注。但是还有一项同样重要的特性，虚拟 DOM 可以把 UI 表示为状态函数的映射（PS. 也就是我们常说的 <code>UI = render(state)</code>），这也使得编写 web 应用有了新的形式。</p> <p>在本文中，我们将研究虚拟 DOM 的概念如何引用到 web 应用中。我们将从简单的例子开始，然后给出一个架构来编写基于 Virtual DOM 的应用。</p> <p>为此我们将选择一个独立的 JavaScript 虚拟 DOM 库，因为我们希望依赖最小化。本文中，我们将使用 snabbdom(<a href="https://github.com/snabbdom/snabbdom" target="_blank" rel="noopener noreferrer">paldepind/snabbdom<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)，但是你也可以使用其他类似的库，比如 Matt Esch 的 <a href="https://github.com/Matt-Esch/virtual-dom" target="_blank" rel="noopener noreferrer">virtual-dom<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="snabbdom简易教程"><a href="#snabbdom简易教程" class="header-anchor">#</a> snabbdom简易教程</h2> <p>snabbdom 是一个模块化的库，所以，我们需要使用一个打包工具，比如 webpack。</p> <p>首先，让我们看看如何进行 snabbdom 的初始化。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> snabbdom <span class="token keyword">from</span> <span class="token string">'snabbdom'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> patch <span class="token operator">=</span> snabbdom<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">[</span>                 <span class="token comment">// 指定模块初始化 patch 方法</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'snabbdom/modules/class'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token comment">// 切换 class </span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'snabbdom/modules/props'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token comment">// 设置 DOM 元素的属性</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'snabbdom/modules/style'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token comment">// 处理元素的 style ，支持动画</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'snabbdom/modules/eventlisteners'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 事件处理</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面的代码中，我们初始化了 snabbdom 模块并添加了一些扩展。在 snabbdom 中，切换 class、style还有 DOM 元素上的属性设置和事件绑定都是给不同模块实现的。上面的实例，只使用了默认提供的模块。</p> <p>核心模块只暴露了一个 <code>patch</code> 方法，它由 init 方法返回。我们使用它创建初始化的 DOM，之后也会使用它来进行 DOM 的更新。</p> <p>下面是一个 Hello World 示例：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> h <span class="token keyword">from</span> <span class="token string">'snabbdom/h'</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">fontWeight</span><span class="token operator">:</span> <span class="token string">'bold'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'Hello world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">patch</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'placeholder'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>h</code> 是一个创建虚拟 DOM 的辅助函数。我们将在文章后面介绍具体用法，现在只需要该函数的 3 个输入参数：</p> <ol><li>一个 CSS 选择器（jQuery 的选择器），比如 <code>div#id.class</code>。</li> <li>一个可选的数据对象，它包含了虚拟节点的属性（class、styles、events）。</li> <li>一个字符串或者虚拟 DOM 的数组（用于表示该节点的children）。</li></ol> <p>第一次调用的时候，patch 方法需要一个 DOM 占位符和一个初始的虚拟 DOM，然后它会根据虚拟 DOM 创建一个对应的真实 DO树。在随后的的调用中，我们为它提供新旧两个虚拟 DOM，然后它通过 diff 算法比对这两个虚拟 DOM，并找出更新的部分对真实 DOM 进行必要的修改 ，使得真实的 DOM 树为最新的虚拟 DOM 的映射。</p> <p>为了快速上手，我在 GitHub 上创建了一个仓库，其中包含了项目的必要内容。下面让我们来克隆这个仓库（<a href="https://github.com/yelouafi/snabbdom-starter" target="_blank" rel="noopener noreferrer">yelouafi/snabbdom-starter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>），然后运行 <code>npm install</code> 安装依赖。这个仓库使用 Browserify 作为打包工具，文件变更后使用 Watchify 自动重新构建，并且通过 Babel 将 ES6 的代码转成兼容性更好的 ES5。</p> <p>下面运行如下代码：</p> <div class="language- extra-class"><pre class="language-text"><code>npm run watch
</code></pre></div><p>这段代码将启动 watchify 模块，它会在 app 文件夹内，创建一个浏览器能够运行的包：<code>build.js</code> 。模块还将检测我们的 js 代码是否发生改变，如果有修改，会自动的重新构建 <code>build.js</code>。（如果你想手动构建，可以使用：<code>npm run build</code>）</p> <p>在浏览器中打开 <code>app/index.html</code> 就能运行程序，这时候你会在屏幕上看到 “Hello World”。</p> <p>这篇文中的所有案例都能在特定的分支上进行实现，我会在文中链接到每个分支，同时 README.md 文件也包含了所有分支的链接。</p> <h3 id="动态视图"><a href="#动态视图" class="header-anchor">#</a> 动态视图</h3> <blockquote><p>本例的源代码在 <a href="https://github.com/yelouafi/snabbdom-starter/tree/dynamic-view" target="_blank" rel="noopener noreferrer">dynamic-view branch<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>为了突出虚拟 DOM 动态化的优势，接下来会构建一个很简单的时钟。</p> <p>首先修改 <code>app/js/main.js</code>：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token parameter">currentDate</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token string">'Current date '</span> <span class="token operator">+</span> currentDate<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>

<span class="token keyword">var</span> oldVnode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'placeholder'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setInterval</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> newVnode <span class="token operator">=</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  oldVnode <span class="token operator">=</span> <span class="token function">patch</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> newVnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>通过单独的函数 <code>view</code> 来生成虚拟 DOM，它接受一个状态（当前日期）作为输入。</p> <p>该案例展示了虚拟 DOM 的经典使用方式，在不同的时刻构造出新的虚拟 DOM，然后将新旧虚拟 DOM 进行对比，并更新到真实 DOM 上。案例中，我们每秒都构造了一个虚拟 DOM，并用它来更新真实 DOM。</p> <h3 id="事件响应"><a href="#事件响应" class="header-anchor">#</a> 事件响应</h3> <blockquote><p>本例的源代码在 <a href="https://github.com/yelouafi/snabbdom-starter/tree/event-reactivity" target="_blank" rel="noopener noreferrer">event-reactivity branch<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>下面的案例介绍了通过事件系统完成一个打招呼的应用程序：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'Type  your name'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">on</span>   <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">input</span><span class="token operator">:</span> update <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'hr'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token string">'Hello '</span> <span class="token operator">+</span> name<span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>

<span class="token keyword">var</span> oldVnode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'placeholder'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> newVnode <span class="token operator">=</span> <span class="token function">view</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  oldVnode <span class="token operator">=</span> <span class="token function">patch</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> newVnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


oldVnode <span class="token operator">=</span> <span class="token function">patch</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在 snabbdom 中，我们使用 props 对象来设置元素的属性，props 模块会对 props 对象进行处理。类似地，我们通过 on 对象进行元素的时间绑定，eventlistener 模块会对 on 对象进行处理。</p> <p>上面的案例中，update 函数执行了与前面案例中 setInterval 类似的事情：从传入的事件对象中提取出 input 的值，构造出一个新的虚拟 DOM，然后调用 patch ，用新的虚拟 DOM 树更新真实 DOM。</p> <h2 id="复杂的应用程序"><a href="#复杂的应用程序" class="header-anchor">#</a> 复杂的应用程序</h2> <p>使用独立的虚拟 DOM 库的好处是，我们在构建自己的应用时，可以按照自己喜欢的方式来做。你可以使用 MVC 的设计模式，可以使用更现代化的数据流体系，比如 Flux。</p> <p>在这篇文章中，我会介绍一种不太为人所知的架构模式，是我之前在 Elm（一种可编译成 JavaScript 的 函数式语言）中使用过的。Elm 的开发者称这种模式为 <a href="https://github.com/evancz/elm-architecture-tutorial/" target="_blank" rel="noopener noreferrer"> Elm Architecture<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，它的主要优点是允许我们将整个应用编写为一组纯函数。</p> <h3 id="主流程"><a href="#主流程" class="header-anchor">#</a> 主流程</h3> <p>让我们回顾一下上个案例的主流程：</p> <ol><li>通过 view 函数构造出我们初始的虚拟 DOM，在 view 函数中，给 input 输入框添加了一个 input 事件。</li> <li>通过 patch 将虚拟 DOM 渲染到真实 DOM 中，并将 input 事件绑定到真实 DOM 上。</li> <li>等待用户输入……</li> <li>用户输入内容，触发 input 事件，然后调用 update 函数</li> <li>在 update 函数中，我们更新了状态</li> <li>我们传入了新的状态给 view 函数，并生成新的虚拟 DOM （与步骤 1 相同）</li> <li>再次调用 patch，重复上述过程（与步骤 2 相同）</li></ol> <p>上面的过程可以描述成一个循环。如果去掉实现的一些细节，我们可以建立一个抽象的函数调用序列。</p> <p><img src="https://file.shenfq.com/FvyObN9fMncD7cMXJYfZOFQJFQ--.png" alt="主流程"></p> <p><code>user</code> 是用户交互的抽象，我们得到的是函数调用的循环序列。注意，<code>user</code> 函数是异步的，否则这将是一个无限的死循环。</p> <p>让我们将上述过程转换为代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter">initState<span class="token punctuation">,</span> element<span class="token punctuation">,</span> <span class="token punctuation">{</span>view<span class="token punctuation">,</span> update<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> newVnode <span class="token operator">=</span> <span class="token function">view</span><span class="token punctuation">(</span>initState<span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> newState <span class="token operator">=</span> <span class="token function">update</span><span class="token punctuation">(</span>initState<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">main</span><span class="token punctuation">(</span>newState<span class="token punctuation">,</span> newVnode<span class="token punctuation">,</span> <span class="token punctuation">{</span>view<span class="token punctuation">,</span> update<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">patch</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> newVnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>main</code> 函数反映了上述的循环过程：给定一个初始状态（initState），一个 DOM 节点和一个<em>顶层组件</em>（view + update），<code>main</code> 通过当前的状态经过 view 函数构建出新的虚拟 DOM，然后通过补丁的方式更新到真实 DOM上。</p> <p>传递给 <code>view</code> 函数的参数有两个：首先是<em>当前</em>状态，其次是事件处理的回调函数，对生成的视图中触发的事件进行处理。回调函数主要负责为应用程序构建一个新的状态，并使用新的状态重启 UI 循环。</p> <p>新状态的构造委托给顶层组件的 <code>update</code> 函数，该函数是一个简单的纯函数：无论何时，给定当前状态和当前程序的输入（事件或行为），它都会为程序返回一个新的状态。</p> <p>要注意的是，除了 patch 方法会有副作用，主函数内不会有任何改变状态行为发生。</p> <p>main 函数有点类似于低级GUI框架的 <code>main</code> 事件循环，这里的重点是收回对 UI 事件分发流程的控制: 在实际状态下，DOM API通过采用观察者模式强制我们进行事件驱动，但是我们不想在这里使用观察者模式，下面就会讲到。</p> <h3 id="elm-架构-elm-architecture"><a href="#elm-架构-elm-architecture" class="header-anchor">#</a> Elm 架构（Elm architecture）</h3> <p><img src="https://file.shenfq.com/Fs8usRuYQCOKL621r-fRyMsr9ZcI.png" alt="Elm architecture"></p> <p>基于 Elm-architecture 的程序中，是由一个个模块或者说组件构成的。每个组件都有两个基本函数：<code>update</code>和<code>view</code>，以及一个特定的数据结构：组件拥有的 <code>model</code> 以及更新该 <code>model</code> 实例的 <code>actions</code>。</p> <ol><li><code>update</code> 是一个纯函数，接受两个参数：组件拥有的 <code>model</code> 实例，表示当前的状态（state），以及一个 <code>action</code> 表示需要执行的更新操作。它将返回一个新的 <code>model</code> 实例。</li> <li><code>view</code> 同样接受两个参数：当前 <code>model</code> 实例和一个事件通道，它可以通过多种形式传播数据，在我们的案例中，将使用一个简单的回调函数。该函数返回一个新的虚拟 DOM，该虚拟 DOM 将会渲染成真实 DOM。</li></ol> <p>如上所述，Elm architecture 摆脱了传统的由事件进行驱动观察者模式。相反该架构倾向于集中式的管理数据（比如 React/Flux），任何的事件行为都会有两种方式：</p> <ol><li>冒泡到顶层组件；</li> <li>通过组件树的形式进行下发，在此阶段，每个组件都可以选择自己的处理方式，或者转发给其他一个或所有子组件。</li></ol> <p>该架构的另一个关键点，就是将程序需要的整个状态都保存在一个对象中。树中的每个组件都负责将它们拥有的状态的一部分传递给子组件。</p> <p>在我们的案例中，我们将使用与 Elm 网站相同的案例，因为它完美的展示了该模式。</p> <h3 id="案例一-计数器"><a href="#案例一-计数器" class="header-anchor">#</a> 案例一：计数器</h3> <blockquote><p>本例的源代码在 <a href="https://github.com/yelouafi/snabbdom-starter/tree/counter-1" target="_blank" rel="noopener noreferrer">counter-1 branch<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>我们在 “counter.js” 中定义了 counter 组件：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token constant">INC</span> <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'inc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">DEC</span> <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'dec'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// model : Number</span>
<span class="token keyword">function</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token parameter">count<span class="token punctuation">,</span> handler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">on</span>   <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">click</span><span class="token operator">:</span> <span class="token function">handler</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">INC</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'+'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">on</span>   <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">click</span><span class="token operator">:</span> <span class="token function">handler</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">DEC</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Count : </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>


<span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">count<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span>  action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token constant">INC</span> <span class="token operator">?</span> count <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token operator">:</span> action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token constant">DEC</span> <span class="token operator">?</span> count <span class="token operator">-</span> <span class="token number">1</span>
        <span class="token operator">:</span> count<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span> view<span class="token punctuation">,</span> update<span class="token punctuation">,</span> <span class="token literal-property property">actions</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token constant">INC</span><span class="token punctuation">,</span> <span class="token constant">DEC</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
</code></pre></div><p>counter 组件由以下属性组成：</p> <ol><li>Model： 一个简单的 <code>Number</code></li> <li>View：为用户提供两个按钮，用户递增、递减计数器，以及显示当前数字</li> <li>Update：接受两个动作：INC / DEC，增加或减少计数器的值</li></ol> <p>首先要注意的是，view/update 都是纯函数，除了输入之外，他们不依赖任何外部环境。计数器组件本身不包括任何状态或变量，它只会从给定的状态构造出固定的视图，以及通过给定的状态更新视图。由于其纯粹性，计数器组件可以轻松的插入任何提供依赖（state 和 action）环境。</p> <p>其次需要注意 <code>handler.bind(null, action)</code> 表达式，每次点击按钮，事件监听器都会触发该函数。我们将原始的用户事件转换为一个有意义的操作（递增或递减），使用了 ES6 的 Symbol 类型，比原始的字符串类型更好（避免了操作名称冲突的问题），稍后我们还将看到更好的解决方案：使用 union 类型。</p> <p>下面看看如何进行组件的测试，我们使用了 “tape” 测试库：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> test <span class="token keyword">from</span> <span class="token string">'tape'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> update<span class="token punctuation">,</span> actions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../app/js/counter'</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'counter update function'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">assert</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    
  <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
  count <span class="token operator">=</span> <span class="token function">update</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> actions<span class="token punctuation">.</span><span class="token constant">INC</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  count <span class="token operator">=</span> <span class="token function">update</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> actions<span class="token punctuation">.</span><span class="token constant">DEC</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  assert<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>我们可以直接使用 babel-node 来进行测试</p> <div class="language- extra-class"><pre class="language-text"><code>babel-node test/counterTest.js
</code></pre></div><h3 id="案例二-两个计数器"><a href="#案例二-两个计数器" class="header-anchor">#</a> 案例二：两个计数器</h3> <blockquote><p>本例的源代码在 <a href="https://github.com/yelouafi/snabbdom-starter/tree/counter-2" target="_blank" rel="noopener noreferrer">counter-2 branch<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>我们将和 Elm 官方教程保持同步，增加计数器的数量，现在我们会有2个计数器。此外，还有一个“重置”按钮，将两个计数器同时重置为“0”;</p> <p>首先，我们需要修改计数器组件，让该组件支持重置操作。为此，我们将引入一个新函数 <code>init</code>，其作用是为计数器构造一个新状态 (count)。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>init</code> 在很多情况下都非常有用。例如，使用来自服务器或本地存储的数据初始化状态。它通过 JavaScript 对象创建一个丰富的数据模型(例如，为一个 JavaScript 对象添加一些原型属性或方法)。</p> <p><code>init</code> 与 <code>update</code> 有一些区别：后者执行一个更新操作，然后从一个状态派生出新的状态；但是前者是使用一些输入值（比如：默认值、服务器数据等等）构造一个状态，输入值是可选的，而且完全不管前一个状态是什么。</p> <p>下面我们将通过一些代码管理两个计数器，我们在 <code>towCounters.js</code> 中实现我们的代码。</p> <p>首先，我们需要定义模型相关的操作类型：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//{ first : counter.model, second : counter.model }</span>

<span class="token keyword">const</span> <span class="token constant">RESET</span>         <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'reset'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">UPDATE_FIRST</span>  <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'update first'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">UPDATE_SECOND</span> <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'update second'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>该模型导出两个属性：first 和 second 分别保存两个计数器的状态。我们定义了三个操作类型：第一个用来将计数器重置为 0，另外两个后面也会讲到。</p> <p>组件通过 init 方法创建 state。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">first</span><span class="token operator">:</span> counter<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">second</span><span class="token operator">:</span> counter<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>view 函数负责展示这两个计数器，并为用户提供一个重置按钮。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token parameter">model<span class="token punctuation">,</span> handler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">on</span>   <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">click</span><span class="token operator">:</span> <span class="token function">handler</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">RESET</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'Reset'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'hr'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    counter<span class="token punctuation">.</span><span class="token function">view</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>first<span class="token punctuation">,</span> <span class="token parameter">counterAction</span> <span class="token operator">=&gt;</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">UPDATE_FIRST</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> counterAction<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'hr'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    counter<span class="token punctuation">.</span><span class="token function">view</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>second<span class="token punctuation">,</span> <span class="token parameter">counterAction</span> <span class="token operator">=&gt;</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">UPDATE_SECOND</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> counterAction<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre></div><p>我们给 view 方法传递了两个参数：</p> <ol><li>每个视图都会获得父组件的部分状态（model.first / model.second）</li> <li>动态处理函数，它会传递到每个子节点的 view 。比如：第一个计数器触发了一个动作，我们会将 <code>UPDATE_FIRST</code> 封装在 action 中，当父类的 update 方法被调用时，我们会将计数器需要的 action（存储在 data 属性中）转发到正确的计数器，并调用计数器的 update 方法。</li></ol> <p>下面看看 update 函数的实现，并导出组件的所有属性。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">model<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span>  action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token constant">RESET</span>     <span class="token operator">?</span>
            <span class="token punctuation">{</span> 
              <span class="token literal-property property">first</span> <span class="token operator">:</span> counter<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token literal-property property">second</span><span class="token operator">:</span> counter<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            
        <span class="token operator">:</span> action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token constant">UPDATE_FIRST</span>   <span class="token operator">?</span>
            <span class="token punctuation">{</span><span class="token operator">...</span>model<span class="token punctuation">,</span> <span class="token literal-property property">first</span> <span class="token operator">:</span> counter<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>first<span class="token punctuation">,</span> action<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">}</span>
            
        <span class="token operator">:</span> action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token constant">UPDATE_SECOND</span>  <span class="token operator">?</span>
            <span class="token punctuation">{</span><span class="token operator">...</span>model<span class="token punctuation">,</span> <span class="token literal-property property">second</span> <span class="token operator">:</span> counter<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>second<span class="token punctuation">,</span> action<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">}</span>
            
        <span class="token operator">:</span> model<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span> view<span class="token punctuation">,</span> init<span class="token punctuation">,</span> update<span class="token punctuation">,</span> <span class="token literal-property property">actions</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token constant">UPDATE_FIRST</span><span class="token punctuation">,</span> <span class="token constant">UPDATE_SECOND</span><span class="token punctuation">,</span> <span class="token constant">RESET</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
</code></pre></div><p>update 函数处理3个操作:</p> <ol><li><code>RESET</code> 操作会调用 init 将每个计数器重置到默认状态。</li> <li><code>UPDATE_FIRST</code> 和 <code>UPDATE_SECOND</code>，会封装一个计数器需要 action。函数将封装好的 action 连同其 state 转发给相关的子计数器。</li></ol> <p><code>{...model, prop: val};</code> 是 ES7 的对象扩展属性（如object .assign），它总是返回一个新的对象。我们不修改参数中传递的 state ，而是始终返回一个相同属性的新 state 对象，确保更新函数是一个纯函数。</p> <p>最后调用 main 方法，构造顶层组件：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">main</span><span class="token punctuation">(</span>
  twoCounters<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// the initial state </span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'placeholder'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
  twoCounters
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>“towCounters” 展示了经典的嵌套组件的使用模式：</p> <ol><li>组件通过类似于树的层次结构进行组织。</li> <li>main 函数调用顶层组件的 view 方法，并将全局的初始状态和处理回调（main handler）作为参数。</li> <li>在视图渲染的时候，父组件调用子组件的 view 函数，并将子组件相关的 state 传给子组件。</li> <li>视图将用户事件转化为对程序更有意义的 actions。</li> <li>从子组件触发的操作会通过父组件向上传递，直到顶层组件。与 DOM 事件的冒泡不同，父组件不会在此阶段进行操作，它能做的就是将相关信息添加到 action 中。</li> <li>在冒泡阶段，父组件的 view 函数可以拦截子组件的 actions ，并扩展一些必要的数据。</li> <li>该操作最终在主处理程序（main handler）中结束，主处理程序将通过调用顶部组件的 update 函数进行派发操作。</li> <li>每个父组件的 update 函数负责将操作分派给其子组件的 update 函数。通常使用在冒泡阶段添加了相关信息的 action。</li></ol> <h3 id="案例三-计数器列表"><a href="#案例三-计数器列表" class="header-anchor">#</a> 案例三：计数器列表</h3> <blockquote><p>本例的源代码在 <a href="https://github.com/yelouafi/snabbdom-starter/tree/counter-3" target="_blank" rel="noopener noreferrer">counter-3 branch<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>让我们继续来看 Elm 的教程，我们将进一步扩展我们的示例，可以管理任意数量的计数器列表。此外还提供新增计数器和删除计数器的按钮。</p> <p>“counter” 组件代码保持不变，我们将定义一个新组件 <code>counterList</code> 来管理计数器数组。</p> <p>我们先来定义模型，和一组关联操作。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/*
model : {
  counters: [{id: Number, counter: counter.model}],
  nextID  : Number
}
*/</span>

<span class="token keyword">const</span> <span class="token constant">ADD</span>     <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'add'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">UPDATE</span>  <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'update counter'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">REMOVE</span>  <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'remove'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">RESET</span>   <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'reset'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>组件的模型包括了两个参数：</p> <ol><li>一个由对象（id，counter）组成的列表，id 属性与前面实例的 first 和 second 属性作用类似；它将标识每个计数器的唯一性。</li> <li><code>nextID</code> 用来维护一个做自动递增的基数，每个新添加的计数器都会使用 <code>nextID + 1</code> 来作为它的 ID。</li></ol> <p>接下来，我们定义 <code>init</code> 方法，它将构造一个默认的 state。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span>  <span class="token punctuation">{</span> <span class="token literal-property property">nextID</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">counters</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>下面定义一个 view 函数。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token parameter">model<span class="token punctuation">,</span> handler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">on</span>   <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">click</span><span class="token operator">:</span> <span class="token function">handler</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">ADD</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'Add'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">on</span>   <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">click</span><span class="token operator">:</span> <span class="token function">handler</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">RESET</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'Reset'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'hr'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div.counter-list'</span><span class="token punctuation">,</span> model<span class="token punctuation">.</span>counters<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token function">counterItemView</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre></div><p>视图提供了两个按钮来触发“添加”和“重置”操作。每个计数器的都通过 <code>counterItemView</code> 函数来生成虚拟 DOM。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">counterItemView</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> handler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div.counter-item'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">key</span><span class="token operator">:</span> item<span class="token punctuation">.</span>id <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'button.remove'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">on</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token function-variable function">click</span><span class="token operator">:</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">REMOVE</span><span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span> item<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'Remove'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    counter<span class="token punctuation">.</span><span class="token function">view</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>counter<span class="token punctuation">,</span> <span class="token parameter">a</span> <span class="token operator">=&gt;</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">UPDATE</span><span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span> item<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> a<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'hr'</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>该函数添加了一个 remove 按钮在视图中，并引用了计数器的 id 添加到 remove 的 action 中。</p> <p>接下来看看 update 函数。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> resetAction <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> counter<span class="token punctuation">.</span>actions<span class="token punctuation">.</span><span class="token constant">INIT</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">model<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  
  <span class="token keyword">return</span>  action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token constant">ADD</span>     <span class="token operator">?</span> <span class="token function">addCounter</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span>
        <span class="token operator">:</span> action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token constant">RESET</span>   <span class="token operator">?</span> <span class="token function">resetCounters</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span>
        <span class="token operator">:</span> action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token constant">REMOVE</span>  <span class="token operator">?</span> <span class="token function">removeCounter</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> action<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
        <span class="token operator">:</span> action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token constant">UPDATE</span>  <span class="token operator">?</span> <span class="token function">updateCounter</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> action<span class="token punctuation">.</span>id<span class="token punctuation">,</span> action<span class="token punctuation">.</span>data<span class="token punctuation">)</span> 
        <span class="token operator">:</span> model<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span> view<span class="token punctuation">,</span> update<span class="token punctuation">,</span> <span class="token literal-property property">actions</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token constant">ADD</span><span class="token punctuation">,</span> <span class="token constant">RESET</span><span class="token punctuation">,</span> <span class="token constant">REMOVE</span><span class="token punctuation">,</span> <span class="token constant">UPDATE</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
</code></pre></div><p>该代码遵循上一个示例的相同的模式，使用冒泡阶段存储的 id 信息，将子节点的 actions 转发到顶层组件。下面是 update 的一个分支 “updateCounter” 。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">updateCounter</span><span class="token punctuation">(</span><span class="token parameter">model<span class="token punctuation">,</span> id<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>model<span class="token punctuation">,</span>
    <span class="token literal-property property">counters</span>  <span class="token operator">:</span> model<span class="token punctuation">.</span>counters<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> 
      item<span class="token punctuation">.</span>id <span class="token operator">!==</span> id <span class="token operator">?</span> 
          <span class="token literal-property property">item</span>
        <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token operator">...</span>item<span class="token punctuation">,</span> 
            <span class="token literal-property property">counter</span> <span class="token operator">:</span> counter<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>counter<span class="token punctuation">,</span> action<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面这种模式可以应用于任何树结构嵌套的组件结构中，通过这种模式，我们让整个应用程序的结构进行了统一。</p> <h3 id="在-actions-中使用-union-类型"><a href="#在-actions-中使用-union-类型" class="header-anchor">#</a> 在 actions 中使用 union 类型</h3> <p>在前面的示例中，我们使用 ES6 的 Symbols 类型来表示操作类型。在视图内部，我们创建了带有操作类型和附加信息（id，子节点的 action）的对象。</p> <p>在真实的场景中，我们必须将 action 的创建逻辑移动到一个单独的工厂函数中（类似于React/Flux中的 Action Creators）。在这篇文章的剩余部分，我将提出一个更符合 FP 精神的替代方案：union 类型。它是 FP 语言（如Haskell）中使用的 <a href="https://en.wikipedia.org/wiki/Algebraic_data_type" target="_blank" rel="noopener noreferrer">代数数据类型<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的子集，您可以将它们看作具有更强大功能的枚举。</p> <p>union类型可以为我们提供以下特性：</p> <ol><li>定义一个可描述所有可能的 actions 的类型。</li> <li>为每个可能的值提供一个工厂函数。</li> <li>提供一个可控的流来处理所有可能的变量。</li></ol> <p>union 类型在 JavaScript 中不是原生的，但是我们可以使用一个库来模拟它。在我们的示例中，我们使用 union-type (<a href="https://github.com/paldepind/union-type" target="_blank" rel="noopener noreferrer">github/union-type<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) ，这是 snabbdom 作者编写的一个小而美的库。</p> <p>先让我们安装这个库：</p> <div class="language- extra-class"><pre class="language-text"><code>npm install --save union-type
</code></pre></div><p>下面我们来定义计数器的 actions：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> Type <span class="token keyword">from</span> <span class="token string">'union-type'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Action <span class="token operator">=</span> <span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">Increment</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">Decrement</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>Type</code> 是该库导出的唯一函数。我们使用它来定义 union 类型 <code>Action</code>，其中包含两个可能的 actions。</p> <p>返回的 <code>Action</code> 具有一组工厂函数，用于创建所有可能的操作。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token parameter">count<span class="token punctuation">,</span> handler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">on</span>   <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">click</span><span class="token operator">:</span> <span class="token function">handler</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> Action<span class="token punctuation">.</span><span class="token function">Increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'+'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">on</span>   <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">click</span><span class="token operator">:</span> <span class="token function">handler</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> Action<span class="token punctuation">.</span><span class="token function">Decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Count : </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre></div><p>在 view 创建递增和递减两种 action。update 函数展示了 uinon 如何对不同类型的 action 进行模式匹配。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">count<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span>  Action<span class="token punctuation">.</span><span class="token function">case</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function-variable function">Increment</span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token function-variable function">Decrement</span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> count <span class="token operator">-</span> <span class="token number">1</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>Action</code> 具有一个 <code>case</code> 方法，该方法接受两个参数：</p> <ul><li>一个对象（变量名和一个回调函数）</li> <li>要匹配的值</li></ul> <p>然后，case方法将提供的 action 与所有指定的变量名相匹配，并调用相应的处理函数。返回值是匹配的回调函数的返回值。</p> <p>类似地，我们看看如何定义 <code>counterList</code> 的 actions</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> Action <span class="token operator">=</span> <span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">Add</span>     <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">Remove</span>  <span class="token operator">:</span> <span class="token punctuation">[</span>Number<span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">Reset</span>   <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">Update</span>  <span class="token operator">:</span> <span class="token punctuation">[</span>Number<span class="token punctuation">,</span> counter<span class="token punctuation">.</span>Action<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>Add</code>和<code>Reset</code>是空数组(即它们没有任何字段)，<code>Remove</code>只有一个字段（计数器的 id）。最后，<code>Update</code> 操作有两个字段：计数器的 id 和计数器触发时的 action。</p> <p>与之前一样，我们在 update 函数中进行模式匹配。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">model<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  
  <span class="token keyword">return</span> Action<span class="token punctuation">.</span><span class="token function">case</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function-variable function">Add</span>     <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">addCounter</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">Remove</span>  <span class="token operator">:</span> <span class="token parameter">id</span> <span class="token operator">=&gt;</span> <span class="token function">removeCounter</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">Reset</span>   <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resetCounters</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">,</span> 
    <span class="token function-variable function">Update</span>  <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">updateCounter</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> id<span class="token punctuation">,</span> action<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注意，<code>Remove</code> 和 <code>Update</code> 都会接受参数。如果匹配成功，<code>case</code> 方法将从 case 实例中提取字段并将它们传递给对应的回调函数。</p> <p>所以典型的模式是：</p> <ul><li>将 actions 建模为union类型。</li> <li>在 view 函数中，使用 union 类型提供的工厂函数创建 action （如果创建的逻辑更复杂，还可以将操作创建委托给单独的函数）。</li> <li>在 update 函数中，使用 <code>case</code> 方法来匹配 union 类型的可能值。</li></ul> <h2 id="todomvc例子"><a href="#todomvc例子" class="header-anchor">#</a> TodoMVC例子</h2> <p>在这个仓库中(<a href="https://github.com/yelouafi/snabbdom-todomvc" target="_blank" rel="noopener noreferrer">github/yelouafi/snabbdom-todomvc<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)，使用本文提到的规范进行了 todoMVC 应用的实现。应用程序由2个模块组成：</p> <ul><li><code>task.js</code> 定义一个呈现单个任务并更新其状态的组件</li> <li><code>todos.js</code>，它管理任务列表以及过滤和更新</li></ul> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>我们已经了解了如何使用小而美的虚 拟DOM 库编写应用程序。当我们不想被迫选择使用React框架（尤其是 class），或者当我们需要一个小型 JavaScript 库时，这将非常有用。</p> <p><em>Elm architecture</em> 提供了一个简单的模式来编写复杂的虚拟DOM应用，具有纯函数的所有优点。这为我们的代码提供了一个简单而规范的结构。使用标准的模式使得应用程序更容易维护，特别是在成员频繁更改的团队中。新成员可以快速掌握代码的总体架构。</p> <p>由于完全用纯函数实现的，我确信只要组件代码遵守其约定，更改组件就不会产生不良的副作用。</p></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间: </span> <span class="time">10/8/2022, 8:09:00 AM</span></div></footer> <!----> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-ac050c62><li class="level-2" data-v-ac050c62><a href="/posts/2019/%E3%80%90%E7%BF%BB%E8%AF%91%E3%80%91%E5%9F%BA%E4%BA%8E%E8%99%9A%E6%8B%9FDOM%E5%BA%93(Snabbdom)%E7%9A%84%E8%BF%B7%E4%BD%A0React.html#snabbdom简易教程" class="sidebar-link reco-side-snabbdom简易教程" data-v-ac050c62>snabbdom简易教程</a></li><li class="level-3" data-v-ac050c62><a href="/posts/2019/%E3%80%90%E7%BF%BB%E8%AF%91%E3%80%91%E5%9F%BA%E4%BA%8E%E8%99%9A%E6%8B%9FDOM%E5%BA%93(Snabbdom)%E7%9A%84%E8%BF%B7%E4%BD%A0React.html#动态视图" class="sidebar-link reco-side-动态视图" data-v-ac050c62>动态视图</a></li><li class="level-3" data-v-ac050c62><a href="/posts/2019/%E3%80%90%E7%BF%BB%E8%AF%91%E3%80%91%E5%9F%BA%E4%BA%8E%E8%99%9A%E6%8B%9FDOM%E5%BA%93(Snabbdom)%E7%9A%84%E8%BF%B7%E4%BD%A0React.html#事件响应" class="sidebar-link reco-side-事件响应" data-v-ac050c62>事件响应</a></li><li class="level-2" data-v-ac050c62><a href="/posts/2019/%E3%80%90%E7%BF%BB%E8%AF%91%E3%80%91%E5%9F%BA%E4%BA%8E%E8%99%9A%E6%8B%9FDOM%E5%BA%93(Snabbdom)%E7%9A%84%E8%BF%B7%E4%BD%A0React.html#复杂的应用程序" class="sidebar-link reco-side-复杂的应用程序" data-v-ac050c62>复杂的应用程序</a></li><li class="level-3" data-v-ac050c62><a href="/posts/2019/%E3%80%90%E7%BF%BB%E8%AF%91%E3%80%91%E5%9F%BA%E4%BA%8E%E8%99%9A%E6%8B%9FDOM%E5%BA%93(Snabbdom)%E7%9A%84%E8%BF%B7%E4%BD%A0React.html#主流程" class="sidebar-link reco-side-主流程" data-v-ac050c62>主流程</a></li><li class="level-3" data-v-ac050c62><a href="/posts/2019/%E3%80%90%E7%BF%BB%E8%AF%91%E3%80%91%E5%9F%BA%E4%BA%8E%E8%99%9A%E6%8B%9FDOM%E5%BA%93(Snabbdom)%E7%9A%84%E8%BF%B7%E4%BD%A0React.html#elm-架构-elm-architecture" class="sidebar-link reco-side-elm-架构-elm-architecture" data-v-ac050c62>Elm 架构（Elm architecture）</a></li><li class="level-3" data-v-ac050c62><a href="/posts/2019/%E3%80%90%E7%BF%BB%E8%AF%91%E3%80%91%E5%9F%BA%E4%BA%8E%E8%99%9A%E6%8B%9FDOM%E5%BA%93(Snabbdom)%E7%9A%84%E8%BF%B7%E4%BD%A0React.html#案例一-计数器" class="sidebar-link reco-side-案例一-计数器" data-v-ac050c62>案例一：计数器</a></li><li class="level-3" data-v-ac050c62><a href="/posts/2019/%E3%80%90%E7%BF%BB%E8%AF%91%E3%80%91%E5%9F%BA%E4%BA%8E%E8%99%9A%E6%8B%9FDOM%E5%BA%93(Snabbdom)%E7%9A%84%E8%BF%B7%E4%BD%A0React.html#案例二-两个计数器" class="sidebar-link reco-side-案例二-两个计数器" data-v-ac050c62>案例二：两个计数器</a></li><li class="level-3" data-v-ac050c62><a href="/posts/2019/%E3%80%90%E7%BF%BB%E8%AF%91%E3%80%91%E5%9F%BA%E4%BA%8E%E8%99%9A%E6%8B%9FDOM%E5%BA%93(Snabbdom)%E7%9A%84%E8%BF%B7%E4%BD%A0React.html#案例三-计数器列表" class="sidebar-link reco-side-案例三-计数器列表" data-v-ac050c62>案例三：计数器列表</a></li><li class="level-3" data-v-ac050c62><a href="/posts/2019/%E3%80%90%E7%BF%BB%E8%AF%91%E3%80%91%E5%9F%BA%E4%BA%8E%E8%99%9A%E6%8B%9FDOM%E5%BA%93(Snabbdom)%E7%9A%84%E8%BF%B7%E4%BD%A0React.html#在-actions-中使用-union-类型" class="sidebar-link reco-side-在-actions-中使用-union-类型" data-v-ac050c62>在 actions 中使用 union 类型</a></li><li class="level-2" data-v-ac050c62><a href="/posts/2019/%E3%80%90%E7%BF%BB%E8%AF%91%E3%80%91%E5%9F%BA%E4%BA%8E%E8%99%9A%E6%8B%9FDOM%E5%BA%93(Snabbdom)%E7%9A%84%E8%BF%B7%E4%BD%A0React.html#todomvc例子" class="sidebar-link reco-side-todomvc例子" data-v-ac050c62>TodoMVC例子</a></li><li class="level-2" data-v-ac050c62><a href="/posts/2019/%E3%80%90%E7%BF%BB%E8%AF%91%E3%80%91%E5%9F%BA%E4%BA%8E%E8%99%9A%E6%8B%9FDOM%E5%BA%93(Snabbdom)%E7%9A%84%E8%BF%B7%E4%BD%A0React.html#总结" class="sidebar-link reco-side-总结" data-v-ac050c62>总结</a></li></ul></main></div> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.318ac574.js" defer></script><script src="/assets/js/3.38c624e7.js" defer></script><script src="/assets/js/1.a547ec77.js" defer></script><script src="/assets/js/33.4355b0d1.js" defer></script>
  </body>
</html>
