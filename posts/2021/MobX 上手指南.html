<!doctype html><html class="" data-reactroot=""><head><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"/>
<meta data-react-helmet="true" charset="utf-8"/><meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"/><meta data-react-helmet="true" name="description" content="å‰ç«¯å·¥ç¨‹å¸ˆ@æ‹¼å¤šå¤šï¼Œçˆ±æŠ˜è…¾ï¼Œæ“…é•¿ JavaScriptï¼Œæ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·ã€Œæ›´äº†ä¸èµ·çš„å‰ç«¯ã€"/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1"/>
<title data-react-helmet="true">MobX ä¸Šæ‰‹æŒ‡å— Â· è‡ªç„¶é†’çš„åšå®¢</title>
<link data-react-helmet="true" rel="stylesheet" href="/assets/index.css"/><link data-react-helmet="true" id="prismTheme" rel="stylesheet" href="/assets/prism.css"/>
<script data-react-helmet="true" >
    const shouldSetIsDark = document.cookie.includes('is_dark=1') ? true : document.cookie.includes('is_dark=0') ? false : window.matchMedia('(prefers-color-scheme: dark)').matches;
    if (shouldSetIsDark) {
      document.documentElement.classList.add('is_dark');
      document.getElementById('prismTheme').href = "/assets/prism_tomorrow.css";
    }
  </script>
</head><body><a class="czs-menu-l show_on_mobile aside_button_open" href="#" style="background-image:url(&quot;/assets/czs-menu-l.svg&quot;)"></a><a class="show_on_mobile aside_button_text" href="/">è‡ªç„¶é†’çš„åšå®¢</a><aside class="hide_on_mobile"><div class="aside_card"><a class="czs-menu-l show_on_mobile aside_button_close" href="#" style="background-image:url(&quot;/assets/czs-close-l.svg&quot;)"></a><h1><a href="/">è‡ªç„¶é†’çš„åšå®¢</a></h1><p class="description">å‰ç«¯å·¥ç¨‹å¸ˆ@æ‹¼å¤šå¤šï¼Œçˆ±æŠ˜è…¾ï¼Œæ“…é•¿ JavaScriptï¼Œæ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·ã€Œæ›´äº†ä¸èµ·çš„å‰ç«¯ã€</p><ul class="social list_style_none"><li class="flex_center"><a class="czs-github-logo" href="https://github.com/Shenfq" target="_blank" style="background-image:url(&quot;/assets/czs-github-logo.svg&quot;)"></a></li><li class="flex_center"><a class="czs-message-l" href="mailto:shenfq95@foxmail.com" target="_blank" style="background-image:url(&quot;/assets/czs-message-l.svg&quot;)"></a></li><li style="flex-grow:1"></li><li class="toggle_dark flex_center"><span class="czs-sun" style="background-image:url(&quot;/assets/czs-sun.svg&quot;)"></span><span class="czs-sun-l" style="background-image:url(&quot;/assets/czs-sun-l.svg&quot;)"></span><span class="czs-moon" style="background-image:url(&quot;/assets/czs-moon.svg&quot;)"></span><span class="czs-moon-l" style="background-image:url(&quot;/assets/czs-moon-l.svg&quot;)"></span></li></ul><nav><ul class="menu list_style_none"><li><a class="flex_center" href="/"><span class="czs-home-l" style="background-image:url(&quot;/assets/czs-home-l.svg&quot;)"></span>é¦–é¡µ</a></li><li><a class="flex_center" href="/categories/"><span class="czs-category-l" style="background-image:url(&quot;/assets/czs-category-l.svg&quot;)"></span>åˆ†ç±»</a></li><li><a class="flex_center" href="/tags/"><span class="czs-tag-l" style="background-image:url(&quot;/assets/czs-tag-l.svg&quot;)"></span>æ ‡ç­¾</a></li><li><a class="flex_center" href="/about/"><span class="czs-about-l" style="background-image:url(&quot;/assets/czs-about-l.svg&quot;)"></span>å…³äº</a></li><li><a class="flex_center" href="/archives/"><span class="czs-box-l" style="background-image:url(&quot;/assets/czs-box-l.svg&quot;)"></span>å½’æ¡£</a></li><li><a class="flex_center" href="/links/index.html"><span class="czs-link-l" style="background-image:url(&quot;/assets/czs-link-l.svg&quot;)"></span>å‹æƒ…é“¾æ¥</a></li></ul></nav></div><nav class="toc"><ol><li><a href="#%E9%A2%98%E5%A4%96%E8%AF%9D">é¢˜å¤–è¯</a></li><li><a href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8">å¦‚ä½•ä½¿ç”¨ï¼Ÿ</a><ol><li><a href="#%E5%93%8D%E5%BA%94%E5%BC%8F%E5%AF%B9%E8%B1%A1">å“åº”å¼å¯¹è±¡</a></li><li><a href="#%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7">è®¡ç®—å±æ€§</a></li><li><a href="#%E4%BF%AE%E6%94%B9%E8%A1%8C%E4%B8%BA">ä¿®æ”¹è¡Œä¸º</a></li><li><a href="#%E7%9B%91%E5%90%AC%E5%AF%B9%E8%B1%A1%E5%8F%98%E6%9B%B4">ç›‘å¬å¯¹è±¡å˜æ›´</a></li></ol></li><li><a href="#%E6%80%BB%E7%BB%93">æ€»ç»“</a></li></ol></nav></aside><section class="main"><h1>MobX ä¸Šæ‰‹æŒ‡å—</h1><div class="main_post_meta"><time dateTime="2021/01/25">2021-01-26</time> Â· <!-- -->shenfq</div><article><p>ä¹‹å‰ç”¨ Redux æ¯”è¾ƒå¤šï¼Œä¸€ç›´å¬è¯´ Mobx èƒ½è®©ä½ ä½“éªŒåˆ°åœ¨ React é‡Œé¢å†™ Vue çš„æ„Ÿè§‰ï¼Œä»Šå¤©æ‰“ç®—å°è¯•ä¸‹ Mobx æ˜¯ä¸æ˜¯çœŸçš„æœ‰å†™ Vue çš„æ„Ÿè§‰ã€‚</p>
<h2 id="%E9%A2%98%E5%A4%96%E8%AF%9D">é¢˜å¤–è¯<a class="anchor" href="#%E9%A2%98%E5%A4%96%E8%AF%9D">Â§</a></h2>
<p>åœ¨ä»‹ç» MobX çš„ç”¨æ³•ä¹‹å‰ï¼Œå…ˆè¯´ç‚¹é¢˜å¤–è¯ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹ MobX çš„ä¸­æ–‡ç®€ä»‹ã€‚åœ¨ MobX çš„ä¸­æ–‡ç½‘ç«™ä¸Šå†™ç€ï¼š</p>
<blockquote>
<p>MobX æ˜¯ä¸€ä¸ªç»è¿‡æˆ˜ç«æ´—ç¤¼çš„åº“ï¼Œå®ƒé€šè¿‡é€æ˜çš„å‡½æ•°å“åº”å¼ç¼–ç¨‹ä½¿å¾—çŠ¶æ€ç®¡ç†å˜å¾—ç®€å•å’Œå¯æ‰©å±•ã€‚</p>
</blockquote>
<p><img src="https://file.shenfq.com/pic/20210118134728.png" alt="æ•°æ®æµ"></p>
<p>â€œæˆ˜ç«æ´—ç¤¼çš„åº“â€ æ€ä¹ˆçœ‹éƒ½æ„Ÿè§‰å¾ˆå¥‡æ€ªï¼Œè¯»èµ·æ¥å¾ˆæ‹—å£ğŸ˜‚ï¼Œè€Œä¸”ç½‘ä¸Šå¾ˆå¤šä»‹ç» MobX çš„æ–‡ç« éƒ½æ˜¯è¿™ä¹ˆå†™çš„ï¼Œåœ¨ <a href="https://github.com/mobxjs/mobx">github</a> ç¿»é˜…å…¶ README å‘ç°å†™çš„æ˜¯ï¼š</p>
<blockquote>
<p>MobX is a battle tested library that makes state management simple and scalable by transparently applying functional reactive programming (TFRP).</p>
</blockquote>
<p>å¯ä»¥çœ‹åˆ°ä½œè€…åŸæœ¬è¦è¡¨è¾¾çš„æ„æ€æ˜¯ MobX æ˜¯ç»è¿‡äº†è®¸å¤šçš„æµ‹è¯•ï¼Œæ‹¥æœ‰æ¯”è¾ƒå¼ºçš„å¥å£®æ€§ã€‚ä¸‹é¢æ˜¯é€šè¿‡è°·æ­Œç¿»è¯‘çš„ç»“æœï¼Œçœ‹èµ·æ¥ä¹Ÿæ¯”ä¸­æ–‡ç½‘çš„è¡¨è¾¾è¦å‡†ç¡®ä¸€äº›ã€‚</p>
<p><img src="https://file.shenfq.com/pic/20210123154105.png" alt="è°·æ­Œç¿»è¯‘"></p>
<p>è™½ç„¶ï¼Œæˆ‘çš„è‹±æ–‡æ°´å¹³ä¹Ÿå¾ˆèœï¼Œè¿˜æ˜¯ä¼šå°½é‡çœ‹å®˜æ–¹çš„æ–‡æ¡£ï¼Œè¿™æ ·å¯ä»¥é¿å…ä¸€äº›ä¸å¿…è¦çš„è¯¯è§£ã€‚</p>
<h2 id="%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8">å¦‚ä½•ä½¿ç”¨ï¼Ÿ<a class="anchor" href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8">Â§</a></h2>
<p>è¨€å½’æ­£ä¼ ï¼ŒMobX ç°åœ¨çš„æœ€æ–°ç‰ˆæ˜¯ 6.0ï¼Œè¿™ä¸ªç‰ˆæœ¬çš„ API ç›¸æ¯”äºä¹‹å‰æœ‰äº†æå¤§çš„ç®€åŒ–ï¼Œå¯ä»¥è¯´æ›´åŠ å¥½ç”¨äº†ã€‚ä¹‹å‰çš„ç‰ˆæœ¬æ˜¯è£…é¥°å™¨é£æ ¼çš„è¯­æ³•ç³–ï¼Œä½†æ˜¯è£…é¥°å™¨åœ¨ç°åœ¨çš„ ES è§„èŒƒä¸­å¹¶ä¸æˆç†Ÿï¼Œè€Œä¸”å¼•å…¥è£…é¥°å™¨è¯­æ³•ä¹Ÿåœ¨å¢åŠ æ‰“åŒ…åçš„ä»£ç ä½“ç§¯ã€‚ç»¼åˆè€ƒè™‘åï¼ŒMobX 6.0 å–æ¶ˆäº†è£…é¥°å™¨è¯­æ³•çš„ APIã€‚</p>
<h3 id="%E5%93%8D%E5%BA%94%E5%BC%8F%E5%AF%B9%E8%B1%A1">å“åº”å¼å¯¹è±¡<a class="anchor" href="#%E5%93%8D%E5%BA%94%E5%BC%8F%E5%AF%B9%E8%B1%A1">Â§</a></h3>
<p>MobX é€šè¿‡ <code>makeObservable</code> æ–¹æ³•æ¥æ„é€ å“åº”å¼å¯¹è±¡ï¼Œä¼ å…¥çš„å¯¹è±¡å±æ€§ä¼šé€šè¿‡  <code>Proxy</code> ä»£ç†ï¼Œä¸ Vue ç±»ä¼¼ï¼Œåœ¨ 6.0 ç‰ˆæœ¬ä¹‹å‰ä½¿ç”¨çš„æ˜¯   <code>Object.defineProperty</code>  APIï¼Œå½“ç„¶ 6.0 ä¹Ÿæä¾›äº†é™çº§æ–¹æ¡ˆã€‚</p>
<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> configure<span class="token punctuation">,</span> makeObservable<span class="token punctuation">,</span> observable<span class="token punctuation">,</span> action<span class="token punctuation">,</span> computed <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'mobx'</span>

<span class="token comment">// ä½¿ç”¨è¯¥é…ç½®ï¼Œå¯ä»¥å°† Proxy é™çº§ä¸º Object.defineProperty</span>
<span class="token function">configure</span><span class="token punctuation">(</span><span class="token punctuation">{</span> useProxies<span class="token operator">:</span> <span class="token string">"never"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ„é€ å“åº”å¯¹è±¡</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">makeObservable</span><span class="token punctuation">(</span>
  <span class="token comment">// éœ€è¦ä»£ç†çš„å“åº”å¯¹è±¡</span>
  <span class="token punctuation">{</span>
    count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token keyword">get</span> <span class="token function">double</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">count</span> <span class="token operator">*</span> <span class="token number">2</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">count</span> <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">count</span> <span class="token operator">-=</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// å¯¹å„ä¸ªå±æ€§è¿›è¡ŒåŒ…è£…ï¼Œç”¨äºæ ‡è®°è¯¥å±æ€§çš„ä½œç”¨</span>
  <span class="token punctuation">{</span>
    count<span class="token operator">:</span> observable<span class="token punctuation">,</span> <span class="token comment">// éœ€è¦è·Ÿè¸ªçš„å“åº”å±æ€§</span>
    double<span class="token operator">:</span> computed<span class="token punctuation">,</span>  <span class="token comment">// è®¡ç®—å±æ€§</span>
    increment<span class="token operator">:</span> action<span class="token punctuation">,</span> <span class="token comment">// action è°ƒç”¨åï¼Œä¼šä¿®æ”¹å“åº”å¯¹è±¡</span>
    decrement<span class="token operator">:</span> action<span class="token punctuation">,</span> <span class="token comment">// action è°ƒç”¨åï¼Œä¼šä¿®æ”¹å“åº”å¯¹è±¡</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre>
<p>æˆ‘ä»¬åœ¨çœ‹çœ‹ä¹‹å‰ç‰ˆæœ¬çš„ MobXï¼Œä½¿ç”¨è£…é¥°å™¨çš„å†™æ³•ï¼š</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Store</span> <span class="token punctuation">{</span>
  @observable count <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">makeObservable</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  @action <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  @action <span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token operator">--</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  @computed <span class="token keyword">get</span> <span class="token function">double</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">count</span> <span class="token operator">*</span> <span class="token number">2</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Store</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>è¿™ä¹ˆçœ‹èµ·æ¥ï¼Œå¥½åƒå†™æ³•å¹¶æ²¡æœ‰å¾—åˆ°ä»€ä¹ˆç®€åŒ–ï¼Œå¥½åƒæ¯”å†™è£…é¥°å™¨è¿˜è¦å¤æ‚ç‚¹ã€‚ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹ 6.0 ç‰ˆæœ¬ä¸€ä¸ªæ›´å¼ºå¤§çš„ APIï¼š<code>makeAutoObservable</code>ã€‚</p>
<p><code>makeAutoObservable</code> æ˜¯ä¸€ä¸ªæ›´å¼ºå¤§çš„ <code>makeObservable</code>ï¼Œå¯ä»¥è‡ªåŠ¨ä¸ºå±æ€§åŠ ä¸Šå¯¹è±¡çš„åŒ…è£…å‡½æ•°ï¼Œä¸Šæ‰‹æˆæœ¬ç›´çº¿ä¸‹é™ã€‚</p>
<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> makeAutoObservable <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'mobx'</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">makeAutoObservable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token keyword">get</span> <span class="token function">double</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">count</span> <span class="token operator">*</span> <span class="token number">2</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">count</span> <span class="token operator">+=</span> <span class="token number">1</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">count</span> <span class="token operator">-=</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h3 id="%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7">è®¡ç®—å±æ€§<a class="anchor" href="#%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7">Â§</a></h3>
<p>MobX çš„å±æ€§ä¸ Vue çš„ <code>computed</code> ä¸€æ ·ï¼Œåœ¨ <code>makeAutoObservable</code> ä¸­å°±æ˜¯ä¸€ä¸ª <code>getter</code>ï¼Œ<code>getter</code> ä¾èµ–çš„å€¼ä¸€æ—¦å‘ç”Ÿå˜åŒ–ï¼Œ<code>getter</code> æœ¬èº«çš„è¿”å›å€¼ä¹Ÿä¼šè·Ÿéšå˜åŒ–ã€‚</p>
<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> makeAutoObservable <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'mobx'</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">makeAutoObservable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token keyword">get</span> <span class="token function">double</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">count</span> <span class="token operator">*</span> <span class="token number">2</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>å½“ <code>store.count</code> ä¸º 1 æ—¶ï¼Œè°ƒç”¨ <code>store.double</code> ä¼šè¿”å› 2ã€‚</p>
<h3 id="%E4%BF%AE%E6%94%B9%E8%A1%8C%E4%B8%BA">ä¿®æ”¹è¡Œä¸º<a class="anchor" href="#%E4%BF%AE%E6%94%B9%E8%A1%8C%E4%B8%BA">Â§</a></h3>
<p>å½“æˆ‘ä»¬éœ€è¦ä¿®æ”¹ store ä¸Šçš„å“åº”å±æ€§æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç›´æ¥é‡æ–°èµ‹å€¼çš„æ–¹å¼ä¿®æ”¹ï¼Œä½†æ˜¯è¿™æ ·ä¼šå¾—åˆ° MobX çš„è­¦å‘Šâš ï¸ã€‚</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">makeAutoObservable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  count<span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">"increment"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  store<span class="token punctuation">.</span><span class="token property-access">count</span> <span class="token operator">+=</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre>
<p><img src="https://file.shenfq.com/pic/20210124212353.png" alt="warn"></p>
<p>MobX ä¼šæç¤ºï¼Œåœ¨ä¿®æ”¹å“åº”å¼å¯¹è±¡çš„å±æ€§æ—¶ï¼Œéœ€è¦é€šè¿‡ action çš„æ–¹å¼ä¿®æ”¹ã€‚è™½ç„¶ç›´æ¥ä¿®æ”¹ä¹Ÿèƒ½ç”Ÿæ•ˆï¼Œä½†æ˜¯è¿™æ ·ä¼šè®© MobX çŠ¶æ€çš„ç®¡ç†æ¯”è¾ƒæ··ä¹±ï¼Œè€Œä¸”å°†çŠ¶æ€ä¿®æ”¹æ”¾åˆ° action ä¸­ï¼Œèƒ½å¤Ÿè®© MobX åœ¨å†…éƒ¨çš„äº‹åŠ¡æµç¨‹ä¸­è¿›è¡Œä¿®æ”¹ï¼Œä»¥å…æ‹¿åˆ°çš„æŸä¸ªå±æ€§è¿˜å¤„äºä¸­é—´æ€ï¼Œæœ€åè®¡ç®—çš„ç»“æœä¸å¤Ÿå‡†ç¡®ã€‚</p>
<p><code>makeAutoObservable</code> ä¸­çš„æ‰€æœ‰æ–¹æ³•éƒ½ä¼šè¢«å¤„ç†æˆ actionã€‚</p>
<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> makeAutoObservable <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'mobx'</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">makeAutoObservable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token keyword">get</span> <span class="token function">double</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">count</span> <span class="token operator">*</span> <span class="token number">2</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// action</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">count</span> <span class="token operator">+=</span> <span class="token number">1</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// action</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">count</span> <span class="token operator">-=</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>ä¸åŒäº Vuexï¼Œå°†çŠ¶æ€çš„ä¿®æ”¹åˆ’åˆ†ä¸º mutation å’Œ actionï¼ŒåŒæ­¥ä¿®æ”¹æ”¾åˆ° mutation ä¸­ï¼Œå¼‚æ­¥çš„æ“ä½œæ”¾åˆ° action ä¸­ã€‚åœ¨ MobX ä¸­ï¼Œä¸ç®¡æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥æ“ä½œï¼Œéƒ½å¯ä»¥æ”¾åˆ° action ä¸­ï¼Œåªæ˜¯å¼‚æ­¥æ“ä½œåœ¨ä¿®æ”¹å±æ€§æ—¶ï¼Œéœ€è¦å°†èµ‹å€¼æ“ä½œæ”¾åˆ° <code>runInAction</code> ä¸­ã€‚</p>
<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> runInAction<span class="token punctuation">,</span> makeAutoObservable <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'mobx'</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">makeAutoObservable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token keyword">async</span> <span class="token function">initCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ¨¡æ‹Ÿè·å–è¿œç¨‹çš„æ•°æ®</span>
    <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// è·å–æ•°æ®åï¼Œå°†èµ‹å€¼æ“ä½œæ”¾åˆ° runInAction ä¸­</span>
    <span class="token function">runInAction</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">count</span> <span class="token operator">=</span> count
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

store<span class="token punctuation">.</span><span class="token method function property-access">initCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>å¦‚æœä¸è°ƒç”¨ <code>runInAction</code> ï¼Œåˆ™å¯ä»¥ç›´æ¥è°ƒç”¨æœ¬èº«å·²ç»å­˜åœ¨çš„ actionã€‚</p>
<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> runInAction<span class="token punctuation">,</span> makeAutoObservable <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'mobx'</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">makeAutoObservable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">count</span> <span class="token operator">=</span> count
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">async</span> <span class="token function">initCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ¨¡æ‹Ÿè·å–è¿œç¨‹çš„æ•°æ®</span>
    <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// è·å–æ•°æ®åï¼Œè°ƒç”¨å·²æœ‰çš„ action</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setCount</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

store<span class="token punctuation">.</span><span class="token method function property-access">initCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<h3 id="%E7%9B%91%E5%90%AC%E5%AF%B9%E8%B1%A1%E5%8F%98%E6%9B%B4">ç›‘å¬å¯¹è±¡å˜æ›´<a class="anchor" href="#%E7%9B%91%E5%90%AC%E5%AF%B9%E8%B1%A1%E5%8F%98%E6%9B%B4">Â§</a></h3>
<p>æ— è®ºæ˜¯åœ¨ React è¿˜æ˜¯åœ¨å°ç¨‹åºä¸­æƒ³è¦å¼•å…¥ MobXï¼Œéƒ½éœ€è¦åœ¨å¯¹è±¡å˜æ›´çš„æ—¶å€™ï¼Œé€šçŸ¥è°ƒç”¨åŸç”Ÿçš„ <code>setState/setData</code> æ–¹æ³•ï¼Œå°†çŠ¶æ€åŒæ­¥åˆ°è§†å›¾ä¸Šã€‚</p>
<p>é€šè¿‡ <code>autorun</code> æ–¹æ³•å¯ä»¥å®ç°è¿™ä¸ªèƒ½åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ <code>autorun</code> ç†è§£ä¸º React Hooks ä¸­çš„ <code>useEffect</code>ã€‚æ¯å½“ store çš„å“åº”å±æ€§å‘ç”Ÿä¿®æ”¹æ—¶ï¼Œä¼ å…¥ <code>autorun</code> çš„æ–¹æ³•ï¼ˆ<code>effect</code>ï¼‰å°±ä¼šè¢«è°ƒç”¨ä¸€æ¬¡ã€‚</p>
<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> autorun<span class="token punctuation">,</span> makeAutoObservable <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'mobx'</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">makeAutoObservable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">count</span> <span class="token operator">=</span> count
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token operator">++</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token operator">--</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">"increment"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  store<span class="token punctuation">.</span><span class="token property-access">count</span><span class="token operator">++</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> $count <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">"count"</span><span class="token punctuation">)</span>
$count<span class="token punctuation">.</span><span class="token property-access">innerText</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>store<span class="token punctuation">.</span><span class="token property-access">count</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token function">autorun</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  $count<span class="token punctuation">.</span><span class="token property-access">innerText</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>store<span class="token punctuation">.</span><span class="token property-access">count</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>æ¯å½“  <code>button#increment</code> æŒ‰é’®è¢«ç‚¹å‡»çš„æ—¶å€™ï¼Œ<code>span#count</code> å†…çš„å€¼å°±ä¼šè‡ªåŠ¨è¿›è¡ŒåŒæ­¥ã€‚ğŸ‘‰<a href="https://codesandbox.io/embed/mobx6-d9bex">æŸ¥çœ‹å®Œæ•´ä»£ç </a>ã€‚</p>
<p><img src="https://file.shenfq.com/pic/20210124220312.gif" alt="æ•ˆæœæ¼”ç¤º"></p>
<p>é™¤äº† <code>autorun</code> ï¼ŒMobX è¿˜æä¾›äº†æ›´ç²¾ç»†åŒ–çš„ç›‘å¬æ–¹æ³•ï¼š<code>reaction</code>ã€ <code>when</code>ã€‚</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">makeAutoObservable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">count</span> <span class="token operator">=</span> count
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token operator">++</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token operator">--</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// store å‘ç”Ÿä¿®æ”¹ç«‹å³è°ƒç”¨ effect</span>
<span class="token function">autorun</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  $count<span class="token punctuation">.</span><span class="token property-access">innerText</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>store<span class="token punctuation">.</span><span class="token property-access">count</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ç¬¬ä¸€ä¸ªæ–¹æ³•çš„è¿”å›å€¼ä¿®æ”¹åæ‰ä¼šè°ƒç”¨åé¢çš„ effect</span>
<span class="token function">reaction</span><span class="token punctuation">(</span>
  <span class="token comment">// è¡¨ç¤º store.count ä¿®æ”¹åæ‰ä¼šè°ƒç”¨</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> store<span class="token punctuation">.</span><span class="token property-access">count</span><span class="token punctuation">,</span>
  <span class="token comment">// ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå½“å‰å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºä¿®æ”¹å‰çš„å€¼</span>
  <span class="token comment">// æœ‰ç‚¹ç±»ä¼¼ä¸ Vue ä¸­çš„ watch</span>
  <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> prevValue</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'diff'</span><span class="token punctuation">,</span> value <span class="token operator">-</span> prevValue<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ç¬¬ä¸€ä¸ªæ–¹æ³•çš„è¿”å›å€¼ä¸ºçœŸï¼Œç«‹å³è°ƒç”¨åé¢çš„ effect</span>
<span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> store<span class="token punctuation">.</span><span class="token property-access">count</span> <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token property-access">count</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// when æ–¹æ³•è¿˜èƒ½è¿”å›ä¸€ä¸ª promise</span>
<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">await</span> <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> store<span class="token punctuation">.</span><span class="token property-access">count</span> <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">)</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'store.count > 10'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="%E6%80%BB%E7%BB%93">æ€»ç»“<a class="anchor" href="#%E6%80%BB%E7%BB%93">Â§</a></h2>
<p>MobX çš„ä»‹ç»åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œæœ¬æ–‡åªæ˜¯å¤§è‡´çš„åˆ—ä¸¾äº†ä¸€ä¸‹ MobX çš„ APIï¼Œå¸Œæœ›å¤§å®¶èƒ½æœ‰æ‰€æ”¶è·ã€‚åç»­æ‰“ç®—å†æ·±å…¥ç ”ç©¶ä¸‹ MobX çš„å®ç°ï¼Œç­‰æˆ‘ç ”ç©¶å¥½äº†ï¼Œå†å†™ç¯‡æ–‡ç« æ¥åˆ†äº«ã€‚</p></article></section><footer>Powered byÂ <a href="https://github.com/xcatliu/pagic" target="_blank">Pagic</a></footer><script src="https://cdn.pagic.org/react@16.13.1/umd/react.production.min.js"></script><script src="https://cdn.pagic.org/react-dom@16.13.1/umd/react-dom.production.min.js"></script><script type="module" src="/index.js"></script></body></html>