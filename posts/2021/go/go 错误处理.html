<!doctype html><html class="" data-reactroot=""><head><script src="/assets/hm.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"/>
<meta data-react-helmet="true" charset="utf-8"/><meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"/><meta data-react-helmet="true" name="description" content="å‰ç«¯å·¥ç¨‹å¸ˆï¼Œçˆ±æŠ˜è…¾ï¼Œæ“…é•¿ JavaScriptï¼Œæ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·ã€Œæ›´äº†ä¸èµ·çš„å‰ç«¯ã€"/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1"/>
<title data-react-helmet="true">Go é”™è¯¯å¤„ç† Â· è‡ªç„¶é†’çš„åšå®¢</title>
<link data-react-helmet="true" rel="stylesheet" href="/assets/index.css"/><link data-react-helmet="true" id="prismTheme" rel="stylesheet" href="/assets/prism.css"/>
<script data-react-helmet="true" >
    const shouldSetIsDark = document.cookie.includes('is_dark=1') ? true : document.cookie.includes('is_dark=0') ? false : window.matchMedia('(prefers-color-scheme: dark)').matches;
    if (shouldSetIsDark) {
      document.documentElement.classList.add('is_dark');
      document.getElementById('prismTheme').href = "/assets/prism_tomorrow.css";
    }
  </script>
</head><body><a class="czs-menu-l show_on_mobile aside_button_open" href="#" style="background-image:url(&quot;/assets/czs-menu-l.svg&quot;)"></a><a class="show_on_mobile aside_button_text" href="/">è‡ªç„¶é†’çš„åšå®¢</a><aside class="hide_on_mobile"><div class="aside_card"><a class="czs-menu-l show_on_mobile aside_button_close" href="#" style="background-image:url(&quot;/assets/czs-close-l.svg&quot;)"></a><h1><a href="/">è‡ªç„¶é†’çš„åšå®¢</a></h1><p class="description">å‰ç«¯å·¥ç¨‹å¸ˆï¼Œçˆ±æŠ˜è…¾ï¼Œæ“…é•¿ JavaScriptï¼Œæ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·ã€Œæ›´äº†ä¸èµ·çš„å‰ç«¯ã€</p><ul class="social list_style_none"><li class="flex_center"><a class="czs-github-logo" href="https://github.com/Shenfq" target="_blank" style="background-image:url(&quot;/assets/czs-github-logo.svg&quot;)"></a></li><li class="flex_center"><a class="czs-message-l" href="mailto:shenfq95@foxmail.com" target="_blank" style="background-image:url(&quot;/assets/czs-message-l.svg&quot;)"></a></li><li style="flex-grow:1"></li><li class="toggle_dark flex_center"><span class="czs-sun" style="background-image:url(&quot;/assets/czs-sun.svg&quot;)"></span><span class="czs-sun-l" style="background-image:url(&quot;/assets/czs-sun-l.svg&quot;)"></span><span class="czs-moon" style="background-image:url(&quot;/assets/czs-moon.svg&quot;)"></span><span class="czs-moon-l" style="background-image:url(&quot;/assets/czs-moon-l.svg&quot;)"></span></li></ul><nav><ul class="menu list_style_none"><li><a class="flex_center" href="/"><span class="czs-home-l" style="background-image:url(&quot;/assets/czs-home-l.svg&quot;)"></span>é¦–é¡µ</a></li><li><a class="flex_center" href="/categories/"><span class="czs-category-l" style="background-image:url(&quot;/assets/czs-category-l.svg&quot;)"></span>åˆ†ç±»</a></li><li><a class="flex_center" href="/tags/"><span class="czs-tag-l" style="background-image:url(&quot;/assets/czs-tag-l.svg&quot;)"></span>æ ‡ç­¾</a></li><li><a class="flex_center" href="/about/"><span class="czs-about-l" style="background-image:url(&quot;/assets/czs-about-l.svg&quot;)"></span>å…³äº</a></li><li><a class="flex_center" href="/archives/"><span class="czs-box-l" style="background-image:url(&quot;/assets/czs-box-l.svg&quot;)"></span>å½’æ¡£</a></li><li><a class="flex_center" href="/links/index.html"><span class="czs-link-l" style="background-image:url(&quot;/assets/czs-link-l.svg&quot;)"></span>å‹æƒ…é“¾æ¥</a></li></ul></nav></div><nav class="toc"><ol><li><a href="#%E6%9E%84%E9%80%A0-error">æ„é€  error</a><ol><li><a href="#%F0%9F%9B%A0%EF%B8%8Ferrorsnew">ğŸ› ï¸errors.New()</a></li><li><a href="#%F0%9F%9B%A0%EF%B8%8Ffmterrorf">ğŸ› ï¸fmt.Errorf()</a></li></ol></li><li><a href="#panic-%E4%B8%8E-recover">panic() ä¸ recover()</a><ol><li><a href="#panic">panic()</a></li><li><a href="#recover">recover()</a></li></ol></li></ol></nav></aside><section class="main"><h1>Go é”™è¯¯å¤„ç†</h1><div class="main_post_meta"><time dateTime="2021/04/28">2021-04-28</time> Â· <!-- -->shenfq</div><article><h2 id="%E6%9E%84%E9%80%A0-error">æ„é€  error<a class="anchor" href="#%E6%9E%84%E9%80%A0-error">Â§</a></h2>
<p>åœ¨ go è¯­è¨€ä¸­ï¼Œæœ‰ä¸€ä¸ªé¢„å®šä¹‰çš„æ¥å£ï¼š<code>error</code>ï¼Œè¯¥æ¥å£è‡ªå¸¦ä¸€ä¸ª <code>Error()</code> æ–¹æ³•ï¼Œè°ƒç”¨è¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">type</span> <span class="token builtin">error</span> <span class="token keyword">interface</span> <span class="token punctuation">{</span>
  <span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre>
<p>è°ƒç”¨è¯¥æ–¹æ³•ï¼Œä¼šè¿”å›å½“å‰é”™è¯¯çš„å…·ä½“ç»“æœã€‚ä¸€èˆ¬æœ‰ä¸‹é¢å‡ ç§æ–¹å¼ç”Ÿæˆ errorã€‚</p>
<ul>
<li><code>errors.New()</code></li>
<li><code>fmt.Errorf()</code></li>
</ul>
<h3 id="%F0%9F%9B%A0%EF%B8%8Ferrorsnew">ğŸ› ï¸errors.New()<a class="anchor" href="#%F0%9F%9B%A0%EF%B8%8Ferrorsnew">Â§</a></h3>
<p>è°ƒç”¨ <code>errors.New()</code> ä¼šè¿”å›ä¸€ä¸ª error ç±»å‹çš„ç»“æ„ä½“ï¼Œè¯¥ç»“æ„ä½“å†…éƒ¨ä¼šå®ç°ä¸€ä¸ª <code>Error()</code> æ–¹æ³•ï¼Œ è°ƒç”¨è¯¥æ–¹æ³•è¿”å›çš„ç»“æœä¸ºè°ƒç”¨ <code>errors.New()</code> æ–¹æ³•æ—¶ä¼ å…¥çš„å†…å®¹ã€‚</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"errors"</span>
	<span class="token string">"fmt"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">divide</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">error</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> b <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
    <span class="token comment">// è¢«é™¤æ•°ä¸º0ï¼Œåˆ™æ„é€ ä¸€ä¸ª error ç»“æ„ä½“</span>
		<span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"è¢«é™¤æ•°ä¸èƒ½ä¸º0"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">var</span> result <span class="token operator">=</span> a <span class="token operator">/</span> b
	<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> result
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> err <span class="token builtin">error</span> <span class="token comment">// error ç±»å‹æ•°æ®çš„åˆå§‹å€¼ä¸º nilï¼Œç±»ä¼¼äº js ä¸­çš„ null</span>
	<span class="token keyword">var</span> result <span class="token builtin">int</span>

	err<span class="token punctuation">,</span> result <span class="token operator">=</span> <span class="token function">divide</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

  <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœ err ä¸º nilï¼Œè¯´æ˜è¿è¡Œæ­£å¸¸</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"è®¡ç®—ç»“æœ"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœ err ä¸ä¸º nilï¼Œè¯´æ˜è¿è¡Œå‡ºé”™</span>
    <span class="token comment">// è°ƒç”¨ error ç»“æ„ä½“çš„ Error æ–¹æ³•ï¼Œè¾“å‡ºé”™è¯¯åŸå› </span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"è®¡ç®—å‡ºé”™"</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢çš„ä»£ç ä¸­ï¼Œç”±äºè°ƒç”¨ <code>divide</code> é™¤æ³•æ–¹æ³•æ—¶ï¼Œç”±äºä¼ å…¥çš„è¢«é™¤æ•°ä¸º 0ã€‚ç»è¿‡åˆ¤æ–­ï¼Œä¼šæŠ›å‡ºä¸€ä¸ªç”± <code>errors.New</code> æ„é€ çš„ <code>error</code> ç±»å‹çš„ç»“æ„ä½“ã€‚</p>
<p>æˆ‘ä»¬å°†è°ƒç”¨ <code>error.Error()</code> æ–¹æ³•è¿”å›çš„ç»“æœè¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œå¯ä»¥å‘ç°å…¶è¿”å›çš„ç»“æœï¼Œå°±æ˜¯ä¼ å…¥ <code>New</code> æ–¹æ³•çš„å€¼ã€‚</p>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://file.shenfq.com/pic/20210427164350.png" alt=""></p>
<h3 id="%F0%9F%9B%A0%EF%B8%8Ffmterrorf">ğŸ› ï¸fmt.Errorf()<a class="anchor" href="#%F0%9F%9B%A0%EF%B8%8Ffmterrorf">Â§</a></h3>
<p>é€šè¿‡ <code>fmt.Errorf()</code> æ–¹æ³•æ„é€ çš„ error ç»“æ„ä½“ï¼Œä¸è°ƒç”¨  <code>errors.New()</code> æ–¹æ³•çš„ç»“æœç±»ä¼¼ã€‚ä¸åŒçš„æ˜¯ï¼Œ<code>fmt.Errorf()</code> æ–¹æ³•ä¼šè¿›è¡Œä¸€æ¬¡æ•°æ®çš„æ ¼å¼åŒ–ã€‚</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">divide</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">error</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> b <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
    <span class="token comment">// å°†å‚æ•°è¿›è¡Œä¸€æ¬¡æ ¼å¼åŒ–ï¼Œæ ¼å¼åŒ–åçš„å­—ç¬¦ä¸²æ”¾å…¥ error ä¸­</span>
		<span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"æ•°æ® %d ä¸åˆæ³•"</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">var</span> result <span class="token operator">=</span> a <span class="token operator">/</span> b
	<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> result
<span class="token punctuation">}</span>

err<span class="token punctuation">,</span> result <span class="token operator">:=</span> <span class="token function">divide</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"è®¡ç®—å‡ºé”™"</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://file.shenfq.com/pic/20210427165114.png" alt=""></p>
<h2 id="panic-%E4%B8%8E-recover">panic() ä¸ recover()<a class="anchor" href="#panic-%E4%B8%8E-recover">Â§</a></h2>
<h3 id="panic">panic()<a class="anchor" href="#panic">Â§</a></h3>
<p><code>panic()</code> ç›¸å½“äºä¸»åŠ¨åœæ­¢ç¨‹åºè¿è¡Œï¼Œè°ƒç”¨æ—¶ <code>panic()</code> æ—¶ï¼Œéœ€è¦ä¼ å…¥ä¸­æ–­åŸå› ã€‚è°ƒç”¨åï¼Œä¼šåœ¨æ§åˆ¶å°è¾“å‡ºä¸­æ–­åŸå› ï¼Œä»¥åŠä¸­æ–­æ—¶çš„è°ƒç”¨å †æ ˆã€‚æˆ‘ä»¬å¯ä»¥æ”¹é€ ä¸€ä¸‹ä¹‹å‰çš„ä»£ç ï¼š</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">divide</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">error</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> b <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœç¨‹åºå‡ºé”™ï¼Œç›´æ¥åœæ­¢è¿è¡Œ</span>
		<span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"è¢«é™¤æ•°ä¸èƒ½ä¸º0"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">var</span> result <span class="token operator">=</span> a <span class="token operator">/</span> b
	<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> result
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  err<span class="token punctuation">,</span> result <span class="token operator">:=</span> <span class="token function">divide</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"è®¡ç®—å‡ºé”™"</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>åœ¨è¿è¡Œåˆ° <code>panic()</code> å¤„ï¼Œç¨‹åºç›´æ¥ä¸­æ–­ï¼Œå¹¶åœ¨æ§åˆ¶å°æ‰“å°å‡ºäº†ä¸­æ–­åŸå› ã€‚</p>
<p><img src="https://file.shenfq.com/pic/20210427174701.png" alt=""></p>
<p><code>panic()</code> å¯ä»¥ç†è§£ä¸ºï¼Œjs ç¨‹åºä¸­çš„ <code>throw new Error()</code> çš„æ“ä½œã€‚é‚£ä¹ˆï¼Œåœ¨ go ä¸­æœ‰æ²¡æœ‰åŠæ³•ç»ˆæ­¢ <code>panic()</code> ï¼Œä¹Ÿå°±æ˜¯ç±»ä¼¼äº <code>try-catch</code> çš„æ“ä½œï¼Œè®©ç¨‹åºå›åˆ°æ­£å¸¸çš„è¿è¡Œé€»è¾‘ä¸­å‘¢ï¼Ÿ</p>
<h3 id="recover">recover()<a class="anchor" href="#recover">Â§</a></h3>
<p>åœ¨ä»‹ç» <code>recover()</code> æ–¹æ³•ä¹‹å‰ï¼Œè¿˜éœ€è¦ä»‹ç»ä¸€ä¸ª go è¯­è¨€ä¸­çš„å¦ä¸€ä¸ªå…³é”®å­—ï¼š<code>defer</code>ã€‚</p>
<p><code>defer</code> åçš„è¯­å¥ä¼šåœ¨å‡½æ•°è¿›è¡Œ return æ“ä½œä¹‹å‰è°ƒç”¨ï¼Œå¸¸ç”¨äº<code>èµ„æºé‡Šæ”¾</code>ã€<code>é”™è¯¯æ•è·</code>ã€<code>æ—¥å¿—è¾“å‡º</code>ã€‚</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">getData</span><span class="token punctuation">(</span>table<span class="token punctuation">,</span> sql<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">defer</span> ä¸­æ–­è¿æ¥<span class="token punctuation">(</span><span class="token punctuation">)</span>
  db <span class="token operator">:=</span> å»ºç«‹è¿æ¥<span class="token punctuation">(</span>table<span class="token punctuation">)</span>
  data <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token keyword">select</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span>
  <span class="token keyword">return</span> data
<span class="token punctuation">}</span>
</code></pre>
<p><code>defer</code> åçš„è¯­å¥ä¼šè¢«å­˜å‚¨åœ¨ä¸€ä¸ªç±»ä¼¼äºæ ˆçš„æ•°æ®ç»“æ„å†…ï¼Œåœ¨å‡½æ•°ç»“æŸçš„æ—¶å€™ï¼Œè¢«å®šä¹‰çš„è¯­å¥æŒ‰é¡ºåºå‡ºæ ˆï¼Œè¶Šåé¢å®šä¹‰çš„è¯­å¥è¶Šå…ˆè¢«è°ƒç”¨ã€‚</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">divide</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
  <span class="token keyword">defer</span> fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"é™¤æ•°ä¸º"</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span>
  <span class="token keyword">defer</span> fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"è¢«é™¤æ•°ä¸º"</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span>

  result <span class="token operator">:=</span> a <span class="token operator">/</span> b
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"è®¡ç®—ç»“æœä¸º"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>
	<span class="token keyword">return</span> result
<span class="token punctuation">}</span>

<span class="token function">divide</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
</code></pre>
<p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åœ¨å‡½æ•°å¼€å§‹è¿è¡Œçš„æ—¶å€™ï¼Œå…ˆé€šè¿‡ <code>defer</code> å®šä¹‰äº†ä¸¤ä¸ªè¾“å‡ºè¯­å¥ï¼Œå…ˆè¾“å‡º<code>é™¤æ•°</code>ï¼Œåè¾“å‡º<code>è¢«é™¤æ•°</code>ã€‚</p>
<p><img src="https://file.shenfq.com/pic/20210428114124.png" alt=""></p>
<p>å®é™…çš„è¿è¡Œç»“æœæ˜¯ï¼š</p>
<ul>
<li>å…ˆè¾“å‡ºè®¡ç®—ç»“æœï¼›</li>
<li>ç„¶åè¾“å‡ºè¢«é™¤æ•°ï¼›</li>
<li>æœ€åè¾“å‡ºé™¤æ•°ï¼›</li>
</ul>
<p>è¿™å’Œå‰é¢æåˆ°çš„ï¼Œé€šè¿‡ <code>defer</code> å®šä¹‰çš„è¯­å¥ä¼šåœ¨å‡½æ•°ç»“æŸçš„æ—¶å€™ï¼ŒæŒ‰ç…§å‡ºæ ˆçš„æ–¹å¼è¿›è¡Œæ‰§è¡Œï¼Œå…ˆå®šä¹‰çš„åæ‰§è¡Œã€‚<code>defer</code> é™¤äº†ä¼šåœ¨å‡½æ•°ç»“æŸçš„æ—¶å€™æ‰§è¡Œï¼Œå‡ºç°å¼‚å¸¸çš„çš„æ—¶å€™ä¹Ÿä¼šå…ˆèµ° <code>defer</code> çš„é€»è¾‘ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åœ¨è°ƒç”¨äº† <code>panic()</code> æ–¹æ³•åï¼Œç¨‹åºä¸­æ–­è¿‡ç¨‹ä¸­ï¼Œä¹Ÿä¼šå…ˆå°† <code>defer</code> å†…çš„è¯­å¥è¿è¡Œä¸€éã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬é‡æ–°å®šä¹‰ä¹‹å‰çš„ <code>divide</code> å‡½æ•°ï¼Œåœ¨æ‰§è¡Œä¹‹å‰åŠ ä¸Šä¸€ä¸ª <code>defer</code> è¯­å¥ï¼Œ<code>defer</code> åé¢ä¸ºä¸€ä¸ªè‡ªæ‰§è¡Œå‡½æ•°ï¼Œè¯¥å‡½æ•°å†…ä¼šè°ƒç”¨ <code>recover()</code> æ–¹æ³•ã€‚</p>
<p><img src="https://file.shenfq.com/pic/20210428120154.png" alt=""></p>
<p><code>recover()</code> æ–¹æ³•è°ƒç”¨åï¼Œä¼šæ•è·åˆ°å½“å‰çš„ <code>panic()</code> æŠ›å‡ºçš„å¼‚å¸¸ï¼Œå¹¶è¿›è¡Œè¿”å›ï¼Œå¦‚æœæ²¡æœ‰å¼‚å¸¸ï¼Œåˆ™è¿”å› <code>nil</code>ã€‚</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">divide</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
  <span class="token comment">// ä¸­æ–­ä¹‹å‰ï¼Œè°ƒç”¨ defer åå®šä¹‰çš„è¯­å¥</span>
	<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> err <span class="token operator">:=</span> <span class="token function">recover</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"æ•è·é”™è¯¯"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">if</span> b <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
    <span class="token comment">// å‡½æ•°è¿è¡Œè¢«ä¸­æ–­</span>
		<span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"è¢«é™¤æ•°ä¸èƒ½ä¸º0"</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token number">0</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> a <span class="token operator">/</span> b
<span class="token punctuation">}</span>

result <span class="token operator">:=</span> <span class="token function">divide</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"è®¡ç®—ç»“æœ"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>
</code></pre>
<p>ä¸Šé¢çš„ä»£ç è¿è¡Œåï¼Œæˆ‘ä»¬å‘ç°ä¹‹å‰è°ƒç”¨ <code>panic()</code> ä¸­æ–­çš„ç¨‹åºè¢«æ¢å¤äº†ï¼Œè€Œä¸”åé¢çš„è®¡ç®—ç»“æœä¹Ÿæ­£å¸¸è¿›è¡Œè¾“å‡ºäº†ã€‚</p>
<p><img src="https://file.shenfq.com/pic/20210428120544.png" alt=""></p>
<p>è¿™å°±æœ‰ç‚¹ç±»ä¼¼äº <code>try-catch</code> çš„é€»è¾‘äº†ï¼Œåªæ˜¯ <code>recover</code> éœ€è¦æ”¾åœ¨ <code>defer</code> å…³é”®è¯åçš„è¯­å¥ä¸­ï¼Œæ›´åƒæ˜¯ <code>catch</code> å’Œ <code>finally</code> çš„ç»“åˆã€‚</p></article></section><footer>Powered byÂ <a href="https://github.com/xcatliu/pagic" target="_blank">Pagic</a></footer><script src="https://cdn.pagic.org/react@16.13.1/umd/react.production.min.js"></script><script src="https://cdn.pagic.org/react-dom@16.13.1/umd/react-dom.production.min.js"></script><script type="module" src="/index.js"></script></body></html>