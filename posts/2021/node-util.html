<!doctype html><html class="" data-reactroot=""><head><script src="/assets/hm.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"/>
<meta data-react-helmet="true" charset="utf-8"/><meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"/><meta data-react-helmet="true" name="description" content="å‰ç«¯å·¥ç¨‹å¸ˆï¼Œçˆ±æŠ˜è…¾ï¼Œæ“…é•¿ JavaScriptï¼Œæ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·ã€Œè‡ªç„¶é†’çš„ç¬”è®°æœ¬ã€"/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1"/>
<title data-react-helmet="true">ä½ ä¸çŸ¥é“çš„ Node.js Util Â· è‡ªç„¶é†’çš„åšå®¢</title>
<link data-react-helmet="true" rel="stylesheet" href="/assets/index.css"/><link data-react-helmet="true" id="prismTheme" rel="stylesheet" href="/assets/prism.css"/>
<script data-react-helmet="true" >
    const shouldSetIsDark = document.cookie.includes('is_dark=1') ? true : document.cookie.includes('is_dark=0') ? false : window.matchMedia('(prefers-color-scheme: dark)').matches;
    if (shouldSetIsDark) {
      document.documentElement.classList.add('is_dark');
      document.getElementById('prismTheme').href = "/assets/prism_tomorrow.css";
    }
  </script>
</head><body><a class="czs-menu-l show_on_mobile aside_button_open" href="#" style="background-image:url(&quot;/assets/czs-menu-l.svg&quot;)"></a><a class="show_on_mobile aside_button_text" href="/">è‡ªç„¶é†’çš„åšå®¢</a><aside class="hide_on_mobile"><div class="aside_card"><a class="czs-menu-l show_on_mobile aside_button_close" href="#" style="background-image:url(&quot;/assets/czs-close-l.svg&quot;)"></a><h1><a href="/">è‡ªç„¶é†’çš„åšå®¢</a></h1><p class="description">å‰ç«¯å·¥ç¨‹å¸ˆï¼Œçˆ±æŠ˜è…¾ï¼Œæ“…é•¿ JavaScriptï¼Œæ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·ã€Œè‡ªç„¶é†’çš„ç¬”è®°æœ¬ã€</p><ul class="social list_style_none"><li class="flex_center"><a class="czs-github-logo" href="https://github.com/Shenfq" target="_blank" style="background-image:url(&quot;/assets/czs-github-logo.svg&quot;)"></a></li><li class="flex_center"><a class="czs-message-l" href="mailto:shenfq95@foxmail.com" target="_blank" style="background-image:url(&quot;/assets/czs-message-l.svg&quot;)"></a></li><li style="flex-grow:1"></li><li class="toggle_dark flex_center"><span class="czs-sun" style="background-image:url(&quot;/assets/czs-sun.svg&quot;)"></span><span class="czs-sun-l" style="background-image:url(&quot;/assets/czs-sun-l.svg&quot;)"></span><span class="czs-moon" style="background-image:url(&quot;/assets/czs-moon.svg&quot;)"></span><span class="czs-moon-l" style="background-image:url(&quot;/assets/czs-moon-l.svg&quot;)"></span></li></ul><nav><ul class="menu list_style_none"><li><a class="flex_center" href="/"><span class="czs-home-l" style="background-image:url(&quot;/assets/czs-home-l.svg&quot;)"></span>é¦–é¡µ</a></li><li><a class="flex_center" href="/categories/"><span class="czs-category-l" style="background-image:url(&quot;/assets/czs-category-l.svg&quot;)"></span>åˆ†ç±»</a></li><li><a class="flex_center" href="/tags/"><span class="czs-tag-l" style="background-image:url(&quot;/assets/czs-tag-l.svg&quot;)"></span>æ ‡ç­¾</a></li><li><a class="flex_center" href="/about/"><span class="czs-about-l" style="background-image:url(&quot;/assets/czs-about-l.svg&quot;)"></span>å…³äº</a></li><li><a class="flex_center" href="/archives/"><span class="czs-box-l" style="background-image:url(&quot;/assets/czs-box-l.svg&quot;)"></span>å½’æ¡£</a></li><li><a class="flex_center" href="/links/index.html"><span class="czs-link-l" style="background-image:url(&quot;/assets/czs-link-l.svg&quot;)"></span>å‹æƒ…é“¾æ¥</a></li></ul></nav></div><nav class="toc"><ol><li><a href="#%E4%BB%8E%E7%B1%BB%E5%9E%8B%E5%88%A4%E6%96%AD%E8%AF%B4%E8%B5%B7">ä»ç±»å‹åˆ¤æ–­è¯´èµ·</a><ol><li><a href="#%E4%B8%A5%E6%A0%BC%E7%9B%B8%E7%AD%89">ä¸¥æ ¼ç›¸ç­‰</a></li></ol></li><li><a href="#error-first--promise">Error First &amp; Promise</a></li><li><a href="#%E8%B0%83%E8%AF%95%E4%B8%8E%E8%BE%93%E5%87%BA">è°ƒè¯•ä¸è¾“å‡º</a></li></ol></nav></aside><section class="main"><h1>ä½ ä¸çŸ¥é“çš„ Node.js Util</h1><div class="main_post_meta"><time dateTime="Mon Nov 15 2021 07:22:25 GMT+0000 (UTC)">2021-11-15</time> Â· <!-- -->Shenfq</div><article><h2 id="%E4%BB%8E%E7%B1%BB%E5%9E%8B%E5%88%A4%E6%96%AD%E8%AF%B4%E8%B5%B7">ä»ç±»å‹åˆ¤æ–­è¯´èµ·<a class="anchor" href="#%E4%BB%8E%E7%B1%BB%E5%9E%8B%E5%88%A4%E6%96%AD%E8%AF%B4%E8%B5%B7">Â§</a></h2>
<p>åœ¨ JavaScript ä¸­ï¼Œè¿›è¡Œå˜é‡çš„ç±»å‹æ ¡éªŒæ˜¯ä¸€ä¸ªéå¸¸ä»¤äººå¤´ç–¼çš„äº‹ï¼Œå¦‚æœåªæ˜¯ç®€å•çš„ä½¿ç”¨ <code>typeof</code> ä¼šåˆ°å„ç§å„æ ·çš„é—®é¢˜ã€‚</p>
<p>ä¸¾å‡ ä¸ªç®€å•çš„ğŸŒ°ï¼š</p>
<pre class="language-js"><code class="language-js"><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword null nil">null</span><span class="token punctuation">)</span> <span class="token comment">// 'object'</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">)</span> <span class="token comment">// 'object'</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token comment">// 'object'</span>
</code></pre>
<p>åæ¥ï¼Œå¤§å®¶å‘ç°å¯ä»¥ä½¿ç”¨ <code>Object.prototype.toString()</code> æ–¹æ³•æ¥è¿›è¡Œå˜é‡ç±»å‹çš„åˆ¤æ–­ã€‚</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">getTypeString</span> <span class="token operator">=</span> <span class="token parameter">obj</span> <span class="token arrow operator">=></span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token property-access">prototype</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">.</span><span class="token method function property-access">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>

<span class="token function">getTypeString</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span> <span class="token comment">// '[object Null]'</span>
<span class="token function">getTypeString</span><span class="token punctuation">(</span><span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token comment">//'[object String]'</span>
<span class="token function">getTypeString</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token comment">//'[object String]'</span>
</code></pre>
<p>å¯¹ <code>toString()</code> æ–¹æ³•è¿›è¡Œä»£ç†ï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªç±»å‹å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨è¿™ä¸ªå­—ç¬¦ä¸²ä¸Šé¢æäº‹æƒ…ã€‚</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">getTypeString</span> <span class="token operator">=</span> <span class="token parameter">obj</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token property-access">prototype</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">.</span><span class="token method function property-access">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">isType</span> <span class="token operator">=</span> <span class="token parameter">type</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token parameter">obj</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token function">getTypeString</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[object </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]</span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> isArray <span class="token operator">=</span> <span class="token function">isType</span><span class="token punctuation">(</span><span class="token string">'Array'</span><span class="token punctuation">)</span> <span class="token comment">// è¯¥æ–¹æ³•ä¸€èˆ¬é€šè¿‡ Array.isArray ä»£æ›¿</span>

<span class="token keyword">const</span> isNull <span class="token operator">=</span> <span class="token function">isType</span><span class="token punctuation">(</span><span class="token string">'Null'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> isObject <span class="token operator">=</span> <span class="token function">isType</span><span class="token punctuation">(</span><span class="token string">'Object'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> isRegExp <span class="token operator">=</span> <span class="token function">isType</span><span class="token punctuation">(</span><span class="token string">'RegExp'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> isFunction <span class="token operator">=</span> <span class="token function">isType</span><span class="token punctuation">(</span><span class="token string">'Function'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> isAsyncFunction <span class="token operator">=</span> <span class="token function">isType</span><span class="token punctuation">(</span><span class="token string">'AsyncFunction'</span><span class="token punctuation">)</span>
</code></pre>
<pre class="language-js"><code class="language-js"><span class="token function">isNull</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token function">isObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token function">isRegExp</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\w</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token function">isFunction</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token function">isAsyncFunction</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre>
<p>Butï¼Œåœ¨ Node.js ä¸­ï¼Œå†…éƒ¨å…¶å®æ˜¯æœ‰ä¸€ç»„ç”¨æ¥åˆ¤æ–­å˜é‡ç±»å‹çš„ api çš„ã€‚è€Œä¸”åŠŸèƒ½å¼‚å¸¸ä¸°å¯Œï¼Œé™¤äº†åŸºç¡€ç±»å‹çš„åˆ¤æ–­ï¼Œè¿˜æ”¯æŒåˆ¤æ–­ Promise å¯¹è±¡ã€Date å¯¹è±¡ã€å„ç§ArrayBufferã€‚</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> types <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util/types'</span><span class="token punctuation">)</span>

types<span class="token punctuation">.</span><span class="token method function property-access">isDate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
types<span class="token punctuation">.</span><span class="token method function property-access">isPromise</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
types<span class="token punctuation">.</span><span class="token method function property-access">isArrayBuffer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre>
<h3 id="%E4%B8%A5%E6%A0%BC%E7%9B%B8%E7%AD%89">ä¸¥æ ¼ç›¸ç­‰<a class="anchor" href="#%E4%B8%A5%E6%A0%BC%E7%9B%B8%E7%AD%89">Â§</a></h3>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ JavaScript ä¸­ï¼Œå¯¹è±¡æ•°ç»„ç­‰å˜é‡åœ¨åˆ¤æ–­ç›¸ç­‰çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœç”¨ <code>===</code> é€šå¸¸åªä¼šåˆ¤æ–­è¿™ä¸¤ä¸ªå˜é‡æ˜¯å¦æŒ‡å‘åŒä¸€å†…å­˜åœ°å€ã€‚å¦‚æœæƒ³åˆ¤æ–­å¯¹è±¡çš„é”®å¯¹åº”çš„æ‰€æœ‰å€¼æ˜¯å¦ç›¸ç­‰ï¼Œéœ€è¦å¯¹ä¸¤ä¸ªå¯¹è±¡è¿›è¡Œéå†ã€‚åœ¨ <code>util</code> ä¸­ï¼Œæä¾›äº†ä¸€ä¸ªæ–¹æ³•å¯ä»¥ç”¨æ¥åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ä¸¥æ ¼ç›¸ç­‰ï¼š<code>util.isDeepStrictEqual(val1, val2)</code></p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> util <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> val1 <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'shenfq'</span> <span class="token punctuation">}</span>
<span class="token keyword">const</span> val2 <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'shenfq'</span> <span class="token punctuation">}</span>

<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'val1 === val2'</span><span class="token punctuation">,</span> val1 <span class="token operator">===</span> val2<span class="token punctuation">)</span> <span class="token comment">// false</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'isDeepStrictEqual'</span><span class="token punctuation">,</span> util<span class="token punctuation">.</span><span class="token method function property-access">isDeepStrictEqual</span><span class="token punctuation">(</span>val1<span class="token punctuation">,</span> val2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre>
<p><img src="https://file.shenfq.com/pic/202111150955411.png" alt=""></p>
<p>è¯¥æ–¹æ³•åŒæ ·å¯ä»¥ç”¨æ¥åˆ¤æ–­æ•°ç»„ï¼Œæ˜¯å¦ä¸¥æ ¼ç›¸ç­‰ï¼š</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> util <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> arr2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>

<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'arr1 === arr2'</span><span class="token punctuation">,</span> arr1 <span class="token operator">===</span> arr2<span class="token punctuation">)</span> <span class="token comment">// false</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'isDeepStrictEqual'</span><span class="token punctuation">,</span> util<span class="token punctuation">.</span><span class="token method function property-access">isDeepStrictEqual</span><span class="token punctuation">(</span>arr1<span class="token punctuation">,</span> arr2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre>
<p><img src="https://file.shenfq.com/pic/202111150957486.png" alt=""></p>
<h2 id="error-first--promise">Error First &amp; Promise<a class="anchor" href="#error-first--promise">Â§</a></h2>
<p>æ—©æœŸçš„ Node API éƒ½æ˜¯ <code>Error First</code> é£æ ¼çš„ï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰çš„å¼‚æ­¥å‡½æ•°éƒ½ä¼šæ¥å—ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¯¥å›è°ƒçš„ä¸€ä¸ªå‚æ•°ä¸º error å¯¹è±¡ï¼Œå¦‚æœæ­£å¸¸è¿”å› error å¯¹è±¡å°±ä¸º <code>null</code>ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºæˆåŠŸå“åº”çš„ç»“æœã€‚</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// ä¸‹é¢æ˜¯ä¸€ä¸ªè¯»å–æ–‡ä»¶çš„ç¤ºä¾‹</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
fs<span class="token punctuation">.</span><span class="token method function property-access">readFile</span><span class="token punctuation">(</span><span class="token string">'nginx.log'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// è¯»å–æ–‡ä»¶å¤±è´¥</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token keyword control-flow">return</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// è¯»å–æ–‡ä»¶æˆåŠŸï¼Œæ‰“å°ç»“æœ</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>åœ¨ Node 8 å‘å¸ƒçš„æ—¶å€™ï¼Œæ–°å¢äº†ä¸€ä¸ª <code>promisify</code> æ¥å£ï¼Œç”¨äºå°† <code>Error First</code> é£æ ¼çš„ API è½¬ä¸º Promise APIã€‚</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> util <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> readFile <span class="token operator">=</span> util<span class="token punctuation">.</span><span class="token method function property-access">promisify</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token property-access">readFile</span><span class="token punctuation">)</span>
<span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./2021-11-11.log'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> encoding<span class="token operator">:</span> <span class="token string">'utf-8'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">text</span> <span class="token arrow operator">=></span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> 
	<span class="token punctuation">.</span><span class="token keyword control-flow">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token arrow operator">=></span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="https://file.shenfq.com/pic/202111121513772.png" alt=""></p>
<p>ä¸è¿‡ï¼Œåæ¥ä¹Ÿæœ‰å¾ˆå¤šäººè§‰å¾—è¿™äº›åŸç”Ÿ API æ”¯æŒ Promise çš„æ–¹å¼å¤ªè¿‡ç¹çï¼Œæ¯ä¸ª API éƒ½éœ€è¦å•ç‹¬çš„åŒ…è£…ä¸€å±‚ <code>promisify</code> æ–¹æ³•ã€‚åœ¨ Node 10 å‘å¸ƒçš„æ—¶å€™ï¼ŒåŸç”Ÿæ¨¡å—éƒ½æ–°å¢äº†ä¸€ä¸ª <code>.promises</code> å±æ€§ï¼Œå…¶ä¸‹çš„æ‰€æœ‰ API éƒ½èƒ½æ”¯æŒ Promiseã€‚</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">promises</span>
fs<span class="token punctuation">.</span><span class="token method function property-access">readFile</span><span class="token punctuation">(</span><span class="token string">'./2021-11-11.log'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> encoding<span class="token operator">:</span> <span class="token string">'utf-8'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">text</span> <span class="token arrow operator">=></span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> 
	<span class="token punctuation">.</span><span class="token keyword control-flow">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token arrow operator">=></span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="https://file.shenfq.com/pic/202111121529480.png" alt=""></p>
<p><strong>æ³¨æ„</strong>ï¼šNode 14 åï¼Œ<code>promises</code> API åˆæ–°å¢äº†ä¸€ç§å¼•å…¥æ–¹å¼ï¼Œé€šè¿‡ä¿®æ”¹åŒ…åçš„æ–¹å¼å¼•å…¥ã€‚</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs/promises'</span><span class="token punctuation">)</span>
fs<span class="token punctuation">.</span><span class="token method function property-access">readFile</span><span class="token punctuation">(</span><span class="token string">'./2021-11-11.log'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> encoding<span class="token operator">:</span> <span class="token string">'utf-8'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">text</span> <span class="token arrow operator">=></span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> 
	<span class="token punctuation">.</span><span class="token keyword control-flow">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token arrow operator">=></span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="https://file.shenfq.com/pic/202111121538219.png" alt=""></p>
<p>é™¤äº†å°† <code>Error First</code> é£æ ¼çš„ API è½¬ä¸º Promise APIï¼Œ<code>util</code> ä¸­è¿˜æä¾› <code>callbackify</code> æ–¹æ³•ï¼Œç”¨äºå°† <code>async</code> å‡½æ•°è½¬æ¢ä¸º <code>Error First</code> é£æ ¼çš„å‡½æ•°ã€‚</p>
<p>ä¸‹é¢é€šè¿‡ <code>callbackify</code> å°† promise åŒ–çš„ <code>fs</code> è¿˜åŸä¸º <code>Error First</code> é£æ ¼çš„å‡½æ•°ã€‚</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs/promises'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> util <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> readFile <span class="token operator">=</span> util<span class="token punctuation">.</span><span class="token method function property-access">callbackify</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token property-access">readFile</span><span class="token punctuation">)</span>
<span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./2021-11-12.log'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> encoding<span class="token operator">:</span> <span class="token string">'utf-8'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> text</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token keyword control-flow">return</span>
  <span class="token punctuation">}</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="%E8%B0%83%E8%AF%95%E4%B8%8E%E8%BE%93%E5%87%BA">è°ƒè¯•ä¸è¾“å‡º<a class="anchor" href="#%E8%B0%83%E8%AF%95%E4%B8%8E%E8%BE%93%E5%87%BA">Â§</a></h2>
<p>å¦‚æœæœ‰å¼€å‘è¿‡ Node æœåŠ¡ï¼Œåº”è¯¥éƒ½ç”¨è¿‡ <code>debug</code> æ¨¡å—ï¼Œé€šè¿‡è¯¥æ¨¡å—å¯ä»¥åœ¨æ§åˆ¶å°çœ‹åˆ°æ›´åŠ æ˜æ™°çš„è°ƒè¯•ä¿¡æ¯ã€‚</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> debug <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'debug'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> log <span class="token operator">=</span> <span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'shenfq'</span> <span class="token punctuation">}</span>

<span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'å½“å‰ç”¨æˆ·: %o'</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>
</code></pre>
<p><img src="https://file.shenfq.com/pic/202111151432757.png" alt=""></p>
<p>å…¶å®ï¼Œé€šè¿‡ <code>util.debug</code> ä¹Ÿèƒ½å®ç°ç±»ä¼¼çš„æ•ˆæœï¼š</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> debug <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'debug'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> log <span class="token operator">=</span> <span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'shenfq'</span> <span class="token punctuation">}</span>

<span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'å½“å‰ç”¨æˆ·: %o'</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>
</code></pre>
<p>åªæ˜¯åœ¨å¯åŠ¨æ—¶ï¼Œéœ€è¦å°† <code>DEBUG</code> ç¯å¢ƒå˜é‡æ›¿æ¢ä¸º <code>NODE_DEBUG</code>ã€‚</p>
<p><img src="https://file.shenfq.com/pic/202111151431352.png" alt=""></p>
<p>å¦å¤–ï¼Œå¦‚æœä½ æœ‰è®¤çœŸçœ‹ä»£ç ï¼Œåº”è¯¥ä¼šå‘ç°ï¼Œåœ¨ <code>log('å½“å‰ç”¨æˆ·: %o', user)</code> æ–¹æ³•å‰é¢çš„å­—ç¬¦ä¸²ä¸­ï¼Œæœ‰ä¸€ä¸ª <code>%o</code> å ä½ç¬¦ï¼Œè¡¨ç¤ºè¿™ä¸ªåœ°æ–¹å°†ä¼šå¡«å……ä¸€ä¸ªå¯¹è±¡ã€‚è¿™ä¸ªä¸»è¦æ˜¯ç”¨æ¥è¿›è¡Œå­—ç¬¦ä¸²æ ¼å¼åŒ–çš„ã€‚ä¸ C è¯­è¨€æˆ– python ä¸­çš„ï¼Œ<code>printf</code> ç±»ä¼¼ã€‚åŒæ ·ï¼Œåœ¨ <code>util</code> æ¨¡å—ä¸­ï¼Œç›´æ¥æä¾›äº†æ ¼å¼åŒ–çš„æ–¹æ³•ï¼š<code>util.format</code>ã€‚</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> format <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span>

<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>
  <span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'å½“å‰ç”¨æˆ·: %o'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'shenfq'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">25</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre>
<p><img src="https://file.shenfq.com/pic/202111151441619.png" alt=""></p>
<p>é™¤äº† <code>%o</code> å ä½ç¬¦ï¼Œä¸åŒçš„æ•°æ®ç±»å‹åº”ä½¿ç”¨ä¸åŒçš„å ä½ç¬¦ã€‚</p>
<div class="table_wrapper"><table>
<thead>
<tr>
<th>å ä½ç¬¦</th>
<th>ç±»å‹</th>
</tr>
</thead>
<tbody>
<tr>
<td>%s</td>
<td>å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td>%d</td>
<td>æ•°å­—ï¼ˆåŒ…æ‹¬æ•´æ•°å’Œæµ®ç‚¹æ•°ï¼‰</td>
</tr>
<tr>
<td>%i</td>
<td>æ•´æ•°</td>
</tr>
<tr>
<td>%f</td>
<td>æµ®ç‚¹æ•°</td>
</tr>
<tr>
<td>%j</td>
<td>JSON</td>
</tr>
<tr>
<td>%o</td>
<td>Object</td>
</tr>
</tbody>
</table></div>
<p>JavaScript ä¸­çš„å¯¹è±¡æ˜¯ä¸€ä¸ªå¾ˆå¤æ‚çš„ä¸œè¥¿ï¼Œé™¤äº†ç›´æ¥ä½¿ç”¨ <code>util.format</code> å¤–åŠ  <code>%o</code> å ä½ç¬¦çš„æ–¹å¼æ ¼å¼åŒ–å¯¹è±¡ï¼Œ<code>util</code> ä¸­è¿˜æä¾›äº†ä¸€ä¸ªå«åš <code>inspect</code> æ–¹æ³•æ¥è¿›è¡Œå¯¹è±¡æ ¼å¼åŒ–ã€‚</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> inspect <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
  age<span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">'shenfq'</span><span class="token punctuation">,</span>
  work<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'coding'</span><span class="token punctuation">,</span>
    seniority<span class="token operator">:</span> <span class="token number">5</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token function">inspect</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="https://file.shenfq.com/pic/202111151500094.png" alt=""></p>
<p>è¿™ä¹ˆçœ‹ <code>inspect</code> å¥½åƒä»€ä¹ˆéƒ½æ²¡åšï¼Œä½†æ˜¯ <code>inspect</code> æ–¹æ³•è¿˜æœ‰ç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨æ¥è¿›è¡Œæ ¼å¼åŒ–æ—¶çš„ä¸€äº›ä¸ªæ€§åŒ–é…ç½®ã€‚</p>
<ul>
<li><code>depth: number</code>ï¼šæ§åˆ¶æ˜¾ç¤ºå±‚çº§ï¼›</li>
<li><code>sorted: boolean|Function</code>: æ˜¯å¦æŒ‰ç…§keyçš„ç¼–ç å€¼è¿›è¡Œæ’åºï¼›</li>
<li><code>compact: boolean</code>ï¼šæ˜¯å¦è¿›è¡Œå•è¡Œæ˜¾ç¤ºï¼›</li>
</ul>
<p>å½“ç„¶ä¸Šé¢åªæ˜¯ä¸€éƒ¨åˆ†é…ç½®ï¼Œæ›´è¯¦ç»†çš„é…ç½®å¯æŸ¥é˜… node æ–‡æ¡£ï¼Œä¸‹é¢æˆ‘ä»¬å†™å‡ ä¸ªæ¡ˆä¾‹ï¼š</p>
<p>æ‰€æœ‰çš„å±æ€§éƒ½æ¢è¡Œæ˜¾ç¤ºï¼š</p>
<pre class="language-js"><code class="language-js"><span class="token function">inspect</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token punctuation">{</span>
	compact<span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="https://file.shenfq.com/pic/202111151503766.png" alt=""></p>
<p>åªæ ¼å¼åŒ–å¯¹è±¡ç¬¬ä¸€å±‚çš„å€¼ï¼š</p>
<pre class="language-js"><code class="language-js"><span class="token function">inspect</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  depth<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
	compact<span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="https://file.shenfq.com/pic/202111151505583.png" alt=""></p>
<p>æŒ‰ç…§keyå€¼çš„ç¼–ç å€’åºè¾“å‡ºï¼š</p>
<pre class="language-js"><code class="language-js"><span class="token function">inspect</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token punctuation">{</span>
	compact<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token function-variable function">sorted</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> a <span class="token operator">&lt;</span> b <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="https://file.shenfq.com/pic/202111151511158.png" alt=""></p></article></section><footer>Powered byÂ <a href="https://github.com/xcatliu/pagic" target="_blank">Pagic</a></footer><script src="https://cdn.pagic.org/react@16.13.1/umd/react.production.min.js"></script><script src="https://cdn.pagic.org/react-dom@16.13.1/umd/react-dom.production.min.js"></script><script type="module" src="/index.js"></script></body></html>