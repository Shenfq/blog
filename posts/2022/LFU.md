---
title: ä»€ä¹ˆæ˜¯ LFU ç®—æ³•ï¼Ÿ
author: shenfq
date: 2022/03/22
categories:
- å‰ç«¯
tags:
- ç¼“å­˜
- LRU
- LFU
- JavaScript
---

![](https://file.shenfq.com/pic/202203221024302.jpg)

ä¸Šæ¬¡çš„æ–‡ç« ä»‹ç»äº† LRU ç®—æ³•ï¼Œä»Šå¤©æ‰“ç®—æ¥ä»‹ç»ä¸€ä¸‹ LFU ç®—æ³•ã€‚åœ¨ä¸Šç¯‡æ–‡ç« ä¸­æœ‰æåˆ°ï¼Œ LFUï¼ˆ`Least frequently used`ï¼šæœ€å°‘ä½¿ç”¨ï¼‰ç®—æ³•ä¸ LRU ç®—æ³•åªæ˜¯åœ¨æ·˜æ±°ç­–ç•¥ä¸Šæœ‰æ‰€ä¸åŒï¼ŒLRU å€¾å‘äºä¿ç•™æœ€è¿‘æœ‰ä½¿ç”¨çš„æ•°æ®ï¼Œè€Œ LFU å€¾å‘äºä¿ç•™ä½¿ç”¨é¢‘ç‡è¾ƒé«˜çš„æ•°æ®ã€‚

ä¸¾ä¸€ä¸ªç®€å•çš„ğŸŒ°ï¼šç¼“å­˜ä¸­æœ‰ Aã€B ä¸¤ä¸ªæ•°æ®ï¼Œä¸”å·²è¾¾åˆ°ä¸Šé™ï¼Œå¦‚æœ `æ•°æ® A` å…ˆè¢«è®¿é—®äº† 10 æ¬¡ï¼Œç„¶å `æ•°æ® B` è¢«è®¿é—® 1 æ¬¡ï¼Œå½“å­˜å…¥æ–°çš„ `æ•°æ® C` æ—¶ï¼Œå¦‚æœå½“å‰æ˜¯ LRU ç®—æ³•ï¼Œä¼šå°† `æ•°æ® A` æ·˜æ±°ï¼Œè€Œå¦‚æœæ˜¯ LFU ç®—æ³•ï¼Œåˆ™ä¼šæ·˜æ±° `æ•°æ® B`ã€‚

ç®€å•æ¥è¯´ï¼Œå°±æ˜¯åœ¨ LRU ç®—æ³•ä¸­ï¼Œä¸ç®¡è®¿é—®çš„é¢‘ç‡ï¼Œåªè¦æœ€è¿‘è®¿é—®è¿‡ï¼Œå°±ä¸ä¼šå°†è¿™ä¸ªæ•°æ®æ·˜æ±°ï¼Œè€Œåœ¨ LFU ç®—æ³•ä¸­ï¼Œå°†è®¿é—®çš„é¢‘ç‡ä½œä¸ºæƒé‡ï¼Œåªè¦è®¿é—®é¢‘ç‡è¶Šé«˜ï¼Œè¯¥æ•°æ®å°±è¶Šä¸ä¼šè¢«æ·˜æ±°ï¼Œå³ä½¿è¯¥æ•°æ®å¾ˆä¹…æ²¡æœ‰è¢«è®¿é—®è¿‡ã€‚

## ç®—æ³•å®ç°

æˆ‘ä»¬è¿˜æ˜¯é€šè¿‡ä¸€æ®µ JavaScript ä»£ç æ¥å®ç°è¿™ä¸ªé€»è¾‘ã€‚

```js
class LFUCache {
	freqs = {} // ç”¨äºæ ‡è®°è®¿é—®é¢‘ç‡
	cache = {} // ç”¨äºç¼“å­˜æ‰€æœ‰æ•°æ®
	capacity = 0 // ç¼“å­˜çš„æœ€å¤§å®¹é‡
	constructor (capacity) {
    // å­˜å‚¨ LFU å¯ç¼“å­˜çš„æœ€å¤§å®¹é‡
		this.capacity = capacity
	}
}
```

ä¸ LRU ç®—æ³•ä¸€æ ·ï¼ŒLFU ç®—æ³•ä¹Ÿéœ€è¦å®ç° `get` ä¸ `put` ä¸¤ä¸ªæ–¹æ³•ï¼Œç”¨äºè·å–ç¼“å­˜å’Œè®¾ç½®ç¼“å­˜ã€‚

```js
class LFUCache {
  // è·å–ç¼“å­˜
	get (key) { }
  // è®¾ç½®ç¼“å­˜
	put (key, value) { }
}
```

è€è§„çŸ©ï¼Œå…ˆçœ‹è®¾ç½®ç¼“å­˜çš„éƒ¨åˆ†ã€‚å¦‚æœè¯¥ç¼“å­˜çš„ key ä¹‹å‰å­˜åœ¨ï¼Œéœ€è¦æ›´æ–°å…¶å€¼ã€‚

```js
class LFUCache {
  // cache ä½œä¸ºç¼“å­˜çš„å­˜å‚¨å¯¹è±¡
  // å…¶è§£æ„ä¸º: { key: { freq: 0, value: '' } }
  // freq è¡¨ç¤ºè¯¥æ•°æ®è¯»å–çš„é¢‘ç‡ï¼›
  // value è¡¨ç¤ºç¼“å­˜çš„æ•°æ®ï¼›
	cache = {}
  // fregs ç”¨äºå­˜å‚¨ç¼“å­˜æ•°æ®çš„é¢‘ç‡
  // å…¶è§£æ„ä¸º: { 0: [a], 1: [b, c], 2: [d] }
  // è¡¨ç¤º a è¿˜æ²¡è¢«è¯»å–ï¼Œb/c å„è¢«è¯»å–1æ¬¡ï¼Œdè¢«è¯»å–2æ¬¡
  freqs = {}
  // è®¾ç½®ç¼“å­˜
  put (key, value) {
    // å…ˆåˆ¤æ–­ç¼“å­˜æ˜¯å¦å­˜åœ¨
    const cache = this.cache[key]
    if (cache) {
      // å¦‚æœå­˜åœ¨ï¼Œåˆ™é‡ç½®ç¼“å­˜çš„å€¼
      cache.value = value
      // æ›´æ–°ä½¿ç”¨é¢‘ç‡
      let { freq } = cache
      // ä» freqs ä¸­è·å–å¯¹åº” key çš„æ•°ç»„
      const keys = this.freqs[freq]
      const index = keys.indexOf(key)
      // ä»é¢‘ç‡æ•°ç»„ä¸­ï¼Œåˆ é™¤å¯¹åº”çš„ key
      keys.splice(index, 1)
      if (keys.length === 0) {
        // å¦‚æœå½“å‰é¢‘ç‡å·²ç»ä¸å­˜åœ¨ key
        // å°† key åˆ é™¤
        delete this.freqs[freq]
      }
      // æ›´æ–°é¢‘ç‡åŠ  1
      freq = (cache.freq += 1)
      // æ›´æ–°é¢‘ç‡æ•°ç»„
      const freqMap =
            this.freqs[freq] ||
            (this.freqs[freq] = [])
      freqMap.push(key)
      return
    }
  }
}
```

å¦‚æœè¯¥ç¼“å­˜ä¸å­˜åœ¨ï¼Œè¦å…ˆåˆ¤æ–­ç¼“å­˜æ˜¯å¦è¶…è¿‡å®¹é‡ï¼Œå¦‚æœè¶…è¿‡ï¼Œéœ€è¦æ·˜æ±°æ‰ä½¿ç”¨é¢‘ç‡æœ€ä½çš„æ•°æ®ã€‚

```js
class LFUCache {
  // æ›´æ–°é¢‘ç‡
  active (key, cache) {
    // æ›´æ–°ä½¿ç”¨é¢‘ç‡
    let { freq } = cache
    // ä» freqs ä¸­è·å–å¯¹åº” key çš„æ•°ç»„
    const keys = this.freqs[freq]
    const index = keys.indexOf(key)
    // ä»é¢‘ç‡æ•°ç»„ä¸­ï¼Œåˆ é™¤å¯¹åº”çš„ key
    keys.splice(index, 1)
    if (keys.length === 0) {
      // å¦‚æœå½“å‰é¢‘ç‡å·²ç»ä¸å­˜åœ¨ key
      // å°† key åˆ é™¤
      delete this.freqs[freq]
    }
    // æ›´æ–°é¢‘ç‡åŠ  1
    freq = (cache.freq += 1)
    // æ›´æ–°è¯»å–é¢‘ç‡æ•°ç»„
    const freqMap = this.freqs[freq] || (this.freqs[freq] = [])
    freqMap.push(key)
  }
  // è®¾ç½®ç¼“å­˜
  put (key, value) {
    // å…ˆåˆ¤æ–­ç¼“å­˜æ˜¯å¦å­˜åœ¨
    const cache = this.cache[key]
    if (cache) {
      // å¦‚æœå­˜åœ¨ï¼Œåˆ™é‡ç½®ç¼“å­˜çš„å€¼
      cache.value = value
      this.active(key, cache)
      return
    }
    // åˆ¤æ–­ç¼“å­˜æ˜¯å¦è¶…è¿‡å®¹é‡
    const list = Object.keys(this.cache)
    if (list.length >= this.capacity) {
      // è¶…è¿‡å­˜å‚¨å¤§å°ï¼Œåˆ é™¤è®¿é—®é¢‘ç‡æœ€ä½çš„æ•°æ®
      const [first] = Object.keys(this.freqs)
      const keys = this.freqs[first]
      const latest = keys.shift()
      delete this.cache[latest]
      if (keys.length === 0) delete this.freqs[latest]
    }
    // å†™å…¥ç¼“å­˜ï¼Œé»˜è®¤é¢‘ç‡ä¸º0ï¼Œè¡¨ç¤ºè¿˜æœªä½¿ç”¨è¿‡
    this.cache[key] = { value, freq: 0 }
    // å†™å…¥è¯»å–é¢‘ç‡æ•°ç»„
    const freqMap = this.freqs[0] || (this.freqs[0] = [])
    freqMap.push(key)
  }
}
```

å®ç°äº†è®¾ç½®ç¼“å­˜çš„æ–¹æ³•åï¼Œå†å®ç°è·å–ç¼“å­˜å°±å¾ˆå®¹æ˜“äº†ã€‚

```js
class LRUCache {
  // è·å–æ•°æ®
	get (key) {
		if (this.cache[key] !== undefined) {
    	// å¦‚æœ key å¯¹åº”çš„ç¼“å­˜å­˜åœ¨ï¼Œæ›´æ–°å…¶è¯»å–é¢‘ç‡
      // ä¹‹å‰å·²ç»å®ç°è¿‡ï¼Œå¯ä»¥ç›´æ¥å¤ç”¨
			this.active(key)
			return this.cache[key]
		}
		return undefined
  }
}
```

---

å…³äº LFU ç¼“å­˜ç®—æ³•å®ç°å°±åˆ°è¿™é‡Œäº†ï¼Œå½“ç„¶è¯¥ç®—æ³•ä¸€èˆ¬ä½¿ç”¨åŒé“¾è¡¨çš„å½¢å¼æ¥å®ç°ï¼Œè¿™é‡Œçš„å®ç°æ–¹å¼ï¼Œåªæ˜¯ä¸ºäº†æ–¹ä¾¿ç†è§£å…¶åŸç†ï¼Œæ„Ÿå…´è¶£çš„è¯å¯ä»¥åœ¨ç½‘ä¸Šæœç´¢ä¸‹æ›´åŠ é«˜æ•ˆçš„å®ç°æ–¹å¼ã€‚